var GlobalParams={video:{zIndex:1},background:{zIndex:0}};var paella={};paella.player=null;paella.debug={init:false,debug:false,log:function(a){if(!this.init){this.debug=/debug/.test(location.href);this.init=true}if(this.debug){console.log(a)}}};paella.pluginList=["framecontrol.js","playbutton.js","viewmode.js","repeatbutton.js","extended_profiles.js","trimming.js","annotations.js","consolidate.js","social.js","fullscreenbutton.js","break.js","comments.js","description.js","footprints.js","videoload_test.js","qualities.js","questions.js"];paella.events={play:"paella:play",pause:"paella:pause",next:"paella:next",previous:"paella:previous",seeking:"paella:seeking",seeked:"paella:seeked",timeupdate:"paella:timeupdate",timeUpdate:"paella:timeupdate",seekTo:"paella:setseek",endVideo:"paella:endvideo",seekToFrame:"paella:seektotime",seekToTime:"paella:seektotime",setTrim:"paella:settrim",showEditor:"paella:showeditor",hideEditor:"paella:hideeditor",setPlaybackRate:"paella:setplaybackrate",setVolume:"paella:setVolume",setComposition:"paella:setComposition",loadStarted:"paella:loadStarted",loadComplete:"paella:loadComplete",loadPlugins:"paella:loadPlugins",error:"paella:error",setProfile:"paella:setprofile",documentChanged:"paella:documentChanged",didSaveChanges:"paella:didsavechanges",controlBarWillHide:"paella:controlbarwillhide",controlBarDidShow:"paella:controlbardidshow",hidePopUp:"paella:hidePopUp",showPopUp:"paella:showPopUp",trigger:function(a,b){$(document).trigger(a,b)},bind:function(a,b){$(document).bind(a,function(c,d){b(c,d)})}};paella.AsyncLoaderCallback=Class.create({name:"",prevCb:null,nextCb:null,loader:null,initialize:function(a){this.name=a},load:function(b,a){paella.debug.log("loading "+this.name);b()}});paella.AjaxCallback=Class.create(paella.AsyncLoaderCallback,{params:null,type:"get",data:null,mimeType:null,statusCode:null,rawData:null,getParams:function(){return this.params},willLoad:function(a){},didLoadSuccess:function(a){return true},didLoadFail:function(a){return false},initialize:function(b,a){this.name="ajaxCallback";if(a){this.type=a}if(typeof(b)=="string"){this.params={url:b}}else{if(typeof(b)=="object"){this.params=b}else{this.params={}}}},load:function(c,a){var b=this;if(typeof(this.willLoad)=="function"){this.willLoad(this)}paella.ajax.send(this.type,this.getParams(),function(g,e,f,h){var d=true;b.data=g;b.mimeType=e;b.statusCode=f;b.rawData=h;if(typeof(b.didLoadSuccess)=="function"){d=b.didLoadSuccess(b)}if(d){c()}else{a()}},function(g,e,f,h){var d=false;b.data=g;b.mimeType=e;b.statusCode=f;b.rawData=h;if(typeof(b.didLoadFail)=="function"){d=b.didLoadFail(b)}if(d){c()}else{a()}})}});paella.JSONCallback=Class.create(paella.AjaxCallback,{initialize:function(b,a){this.parent(b,a)},didLoadSuccess:function(b){if(typeof(b.data)=="object"){return true}try{b.data=JSON.parse(b.data);return true}catch(a){b.data={error:"Unexpected data format",data:b.data};return false}}});paella.DictionaryCallback=Class.create(paella.AjaxCallback,{initialize:function(a){this.parent({url:a})},getParams:function(){var a=paella.utils.language();this.params.url=this.params.url+"_"+a+".json";return this.params},didLoadSuccess:function(a){paella.dictionary.addDictionary(a.data);return true},didLoadFail:function(a){return true}});paella.AsyncLoader=Class.create({firstCb:null,lastCb:null,callbackArray:null,generatedId:0,currentCb:null,initialize:function(){this.callbackArray={};this.generatedId=0},addCallback:function(a,b){if(!b){b="callback_"+this.generatedId++}this.callbackArray[b]=a;if(!this.firstCb){this.firstCb=a;this.currentCb=a}a.prevCb=this.lastCb;if(this.lastCb){this.lastCb.nextCb=a}this.lastCb=a;a.loader=this;return a},getCallback:function(a){return this.callbackArray[a]},load:function(c,a){var b=this;if(this.currentCb){this.currentCb.load(function(){b.currentCb=b.currentCb.nextCb;b.load(c)},function(){if(typeof(a)=="function"){a()}})}else{if(typeof(c)=="function"){c()}}}});paella.Dictionary=Class.create({dictionary:{},initialize:function(){},addDictionary:function(b){for(var a in b){this.dictionary[a]=b[a]}},translate:function(a){var b=this.dictionary[a];if(b){return b}else{return a}}});paella.dictionary=new paella.Dictionary();paella.ajax=base.ajax;paella.Ajax=Class.create({callback:null,initialize:function(b,e,d,g,c,f){paella.debug.log("WARNING: paella.Ajax() is deprecated, use base.ajax.get/paella.ajax.post/paella.ajax.delete/paella.ajax.put instead.");var a=this;this.callback=d;var a=this;if(!f){f="get"}if(c){jQuery.ajax({url:b,type:f,dataType:"jsonp",jsonp:"jsonp",jsonpCallback:"callback",data:e,cache:false}).always(function(h){a.callCallback(h)})}else{if(g&&g!=""){e.url=b;jQuery.ajax({url:g,type:f,data:e,cache:false}).always(function(h){a.callCallback(h)})}else{jQuery.ajax({url:b,type:f,data:e,cache:false}).always(function(h){a.callCallback(h)})}}},callCallback:function(a){if(this.callback&&a!=null){if(typeof(a)=="object"&&a.responseText){this.callback(a.responseText)}else{this.callback(a)}}else{if(this.callback){this.callback('{"result":"ok"}')}}}});paella.Timer=Timer;paella.utils={ajax:paella.ajax,cookies:{set:function(a,b){document.cookie=a+"="+b},get:function(b){var c,a,e,d=document.cookie.split(";");for(c=0;c<d.length;c++){a=d[c].substr(0,d[c].indexOf("="));e=d[c].substr(d[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return unescape(e)}}}},parameters:{list:null,parse:function(){if(!this.list){var b=window.location.href;if(/https?:\/\/([a-z0-9.\-_\/\~:]*\?)([a-z0-9.\/\-_\%\=\&]*)\#*/i.test(b)){var g=RegExp.$2;var a=g.split("&");this.list={};for(var d=0;d<a.length;++d){var f=a[d].split("=");var c=f[0];var e=f.length==2?f[1]:"";this.list[c]=e}}else{this.list=[]}}},get:function(a){return this.list[a]}},require:function(b){var a=document.createElement("script");a.type="text/javascript";a.src=b;document.getElementsByTagName("head")[0].appendChild(a)},importStylesheet:function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("href",a);b.setAttribute("type","text/css");b.setAttribute("media","screen");document.getElementsByTagName("head")[0].appendChild(b)},Timer:Class.create({timerId:0,callback:null,params:null,jsTimerId:0,repeat:false,timeout:0,initialize:function(c,a,b){this.callback=c;this.params=b;timerManager.setupTimer(this,a)},cancel:function(){clearTimeout(this.jsTimerId)}}),timeParse:{secondsToTime:function(d){var b=~~(d/3600);if(b<10){b="0"+b}var c=~~((d%3600)/60);if(c<10){c="0"+c}var a=Math.floor(d%60);if(a<10){a="0"+a}return b+":"+c+":"+a},secondsToText:function(e){if(e<=1){return paella.dictionary.translate("1 second ago")}if(e<60){return paella.dictionary.translate("{0} seconds ago").replace(/\{0\}/g,e)}var b=Math.round(e/60);if(b<=1){return paella.dictionary.translate("1 minute ago")}if(b<60){return paella.dictionary.translate("{0} minutes ago").replace(/\{0\}/g,b)}var a=Math.round(e/(60*60));if(a<=1){return paella.dictionary.translate("1 hour ago")}if(a<24){return paella.dictionary.translate("{0} hours ago").replace(/\{0\}/g,a)}var c=Math.round(e/(60*60*24));if(c<=1){return paella.dictionary.translate("1 day ago")}if(c<24){return paella.dictionary.translate("{0} days ago").replace(/\{0\}/g,c)}var d=Math.round(e/(60*60*24*30));if(d<=1){return paella.dictionary.translate("1 month ago")}if(d<12){return paella.dictionary.translate("{0} months ago").replace(/\{0\}/g,d)}var f=Math.round(e/(60*60*24*365));if(f<=1){return paella.dictionary.translate("1 year ago")}return paella.dictionary.translate("{0} years ago").replace(/\{0\}/g,f)},matterhornTextDateToDate:function(a){var b=new Date();b.setFullYear(parseInt(a.substring(0,4),10));b.setMonth(parseInt(a.substring(5,7),10)-1);b.setDate(parseInt(a.substring(8,10),10));b.setHours(parseInt(a.substring(11,13),10));b.setMinutes(parseInt(a.substring(14,16),10));b.setSeconds(parseInt(a.substring(17,19),10));return b}},language:function(){var a=navigator.language||window.navigator.userLanguage;return a.substr(0,2).toLowerCase()},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d=="x"?b:b&3|8;return a.toString(16)})},userAgent:new UserAgent()};paella.utils.parameters.parse();paella.MouseManager=Class.create({targetObject:null,initialize:function(){var a=this;paella.events.bind("mouseup",function(b){a.up(b)});paella.events.bind("mousemove",function(b){a.move(b)});paella.events.bind("mouseover",function(b){a.over(b)})},down:function(a,b){this.targetObject=a;if(this.targetObject&&this.targetObject.down){this.targetObject.down(b,b.pageX,b.pageY);b.cancelBubble=true}return false},up:function(a){if(this.targetObject&&this.targetObject.up){this.targetObject.up(a,a.pageX,a.pageY);a.cancelBubble=true}this.targetObject=null;return false},out:function(a){if(this.targetObject&&this.targetObject.out){this.targetObject.out(a,a.pageX,a.pageY);a.cancelBubble=true}return false},move:function(a){if(this.targetObject&&this.targetObject.move){this.targetObject.move(a,a.pageX,a.pageY);a.cancelBubble=true}return false},over:function(a){if(this.targetObject&&this.targetObject.over){this.targetObject.over(a,a.pageX,a.pageY);a.cancelBubble=true}return false}});paella.utils.mouseManager=new paella.MouseManager();paella.ui={};paella.ui.Container=function(b){var a=document.createElement("div");if(b.id){a.id=b.id}if(b.className){a.className=b.className}if(b.style){$(a).css(b.style)}return a};paella.DataDelegate=Class.create({read:function(a,c,b){if(typeof(b)=="function"){b({},true)}},write:function(a,d,b,c){if(typeof(c)=="function"){c({},true)}},remove:function(a,c,b){if(typeof(b)=="function"){b({},true)}}});paella.dataDelegates={};paella.dataDelegates.CookieDataDelegate=Class.create(paella.DataDelegate,{initialize:function(){},serializeKey:function(a,b){if(typeof(b)=="object"){b=JSON.stringify(b)}return a+"|"+b},read:function(b,g,f){var a=this.serializeKey(b,g);var c=paella.utils.cookies.get(a);try{c=unescape(c);c=JSON.parse(c)}catch(d){}if(typeof(f)=="function"){f(c,true)}},write:function(b,e,c,d){var a=this.serializeKey(b,e);if(typeof(c)=="object"){c=JSON.stringify(c)}c=escape(c);paella.utils.cookies.set(a,c);if(typeof(d)=="function"){d({},true)}},remove:function(b,d,c){var a=this.serializeKey(b,d);if(typeof(value)=="object"){value=JSON.stringify(value)}paella.utils.cookies.set(a,"");if(typeof(c)=="function"){c({},true)}}});paella.dataDelegates.MySQLDataDelegate=Class.create(paella.DataDelegate,{initialize:function(){},serializeKey:function(a,b){if(typeof(b)=="object"){b=JSON.stringify(b)}return a+"|"+b},read:function(a,c,b){return null},write:function(c,e,h,f){var d="http://podcast.uc3m.es/paella/webservices/event.php";var b="?action=insert&resource_id="+e.id+"&usuario="+h.user+"&event="+h.type+"&timestamp="+h.timestamp+"&params="+encodeURIComponent(JSON.stringify(h))+"&app="+h.origin;if(b){var e=null;var i=function(j){console.log("Load success");if(typeof(f)=="function"){f({},true)}};var g=false;var a="get";new paella.Ajax(d+b,e,i,null,g,a)}},remove:function(a,c,b){return null}});paella.dataDelegates.DefaultDataDelegate=paella.dataDelegates.CookieDataDelegate;paella.Data=Class.create({enabled:false,dataDelegates:{},initialize:function(a){this.enabled=a.data.enabled;for(var b in a.data.dataDelegates){this.dataDelegates[b]=new paella.dataDelegates[a.data.dataDelegates[b]]()}if(!this.dataDelegates["default"]){this.dataDelegates["default"]=new paella.dataDelegates.DefaultDataDelegate()}},read:function(c,b,d){var a=this.getDelegate(c);a.read(c,b,d)},write:function(c,b,e,d){var a=this.getDelegate(c);a.write(c,b,e,d)},remove:function(c,b,d){var a=this.getDelegate(c);a.remove(c,b,d)},getDelegate:function(a){if(this.dataDelegates[a]){return this.dataDelegates[a]}else{return this.dataDelegates["default"]}}});paella.data=null;paella.MessageBox=Class.create({modalContainerClassName:"modalMessageContainer",frameClassName:"frameContainer",messageClassName:"messageContainer",errorClassName:"errorContainer",currentMessageBox:null,messageContainer:null,onClose:null,initialize:function(){var a=this;$(window).resize(function(b){a.adjustTop()})},showFrame:function(f,e){var c=true;var d="80%";var a="80%";var b=null;if(e){c=e.closeButton;d=e.width;a=e.height;b=e.onClose}this.doShowFrame(f,c,d,a,b)},doShowFrame:function(a,d,c,i,f){this.onClose=f;if(this.currentMessageBox){this.close()}if(!c){c="80%"}if(!i){i="80%"}var e=document.createElement("div");e.className=this.modalContainerClassName;e.style.position="fixed";e.style.top="0px";e.style.left="0px";e.style.right="0px";e.style.bottom="0px";e.style.zIndex=999999;var b=document.createElement("div");b.className=this.frameClassName;b.style.width=c;b.style.height=i;b.style.position="relative";e.appendChild(b);var g=document.createElement("iframe");g.src=a;g.setAttribute("frameborder","0");g.style.width="100%";g.style.height="100%";b.appendChild(g);$("body")[0].appendChild(e);this.currentMessageBox=e;this.messageContainer=b;var h=this;this.adjustTop();if(d){this.createCloseButton()}},showElement:function(g,f){var c=true;var e="60%";var a="40%";var b=null;var d=this.messageClassName;if(f){d=f.className;c=f.closeButton;e=f.width;a=f.height;b=f.onClose}this.doShowElement(g,c,e,a,d,b)},showMessage:function(f,g){var c=true;var e="60%";var a="40%";var b=null;var d=this.messageClassName;if(g){d=g.className;c=g.closeButton;e=g.width;a=g.height;b=g.onClose}this.doShowMessage(f,c,e,a,d,b)},doShowElement:function(d,c,b,i,f,g){this.onClose=g;if(this.currentMessageBox){this.close()}if(!f){f=this.messageClassName}if(!b){b="80%"}if(!i){i="30%"}var e=document.createElement("div");e.className=this.modalContainerClassName;e.style.position="fixed";e.style.top="0px";e.style.left="0px";e.style.right="0px";e.style.bottom="0px";e.style.zIndex=999999;var a=document.createElement("div");a.className=f;a.style.width=b;a.style.height=i;a.style.position="relative";a.appendChild(d);e.appendChild(a);$("body")[0].appendChild(e);this.currentMessageBox=e;this.messageContainer=a;var h=this;this.adjustTop();if(c){this.createCloseButton()}},doShowMessage:function(i,c,b,h,e,f){this.onClose=f;if(this.currentMessageBox){this.close()}if(!e){e=this.messageClassName}if(!b){b="80%"}if(!h){h="30%"}var d=document.createElement("div");d.className=this.modalContainerClassName;d.style.position="fixed";d.style.top="0px";d.style.left="0px";d.style.right="0px";d.style.bottom="0px";d.style.zIndex=999999;var a=document.createElement("div");a.className=e;a.style.width=b;a.style.height=h;a.style.position="relative";a.innerHTML=i;d.appendChild(a);$("body")[0].appendChild(d);this.currentMessageBox=d;this.messageContainer=a;var g=this;this.adjustTop();if(c){this.createCloseButton()}},showError:function(e,f){var c=false;var d="60%";var a="20%";var b=null;if(f){c=f.closeButton;d=f.width;a=f.height;b=f.onClose}this.doShowError(e,c,d,a,b)},doShowError:function(e,c,d,a,b){this.doShowMessage(e,c,d,a,this.errorClassName,b)},createCloseButton:function(){if(this.messageContainer){var a=this;var b=document.createElement("div");this.messageContainer.appendChild(b);b.className="paella_messageContainer_closeButton";$(b).click(function(c){a.onCloseButtonClick()})}},adjustTop:function(){if(this.currentMessageBox){var b=$(this.messageContainer).outerHeight();var a=$(this.currentMessageBox).height();var c=a/2-b/2;this.messageContainer.style.marginTop=c+"px"}},close:function(){if(this.currentMessageBox&&this.currentMessageBox.parentNode){var a=this.currentMessageBox;var b=a.parentNode;$(a).animate({opacity:0},300,function(){b.removeChild(a)});if(this.onClose){this.onClose()}}},onCloseButtonClick:function(){this.close()}});paella.messageBox=new paella.MessageBox();paella.AntiXSS={htmlEscape:function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlUnescape:function(a){return String(a).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}};paella.Node=Class.create({identifier:"",nodeList:null,initialize:function(a){this.nodeList={};this.identifier=a},addTo:function(a){a.addNode(this)},addNode:function(a){this.nodeList[a.identifier]=a;return a},getNode:function(a){return this.nodeList[a]}});paella.DomNode=Class.create(paella.Node,{domElement:null,initialize:function(a,c,b){this.parent(c);this.domElement=document.createElement(a);this.domElement.id=c;if(b){$(this.domElement).css(b)}},addNode:function(a){var b=this.parent(a);this.domElement.appendChild(a.domElement);return b},onresize:function(){}});paella.Button=Class.create(paella.DomNode,{isToggle:false,initialize:function(f,c,d,e){this.isToggle=e;var b={};this.parent("div",f,b);this.domElement.className=c;if(e){var a=this;$(this.domElement).click(function(g){a.toggleIcon()})}$(this.domElement).click("click",d)},isToggled:function(){if(this.isToggle){var a=$("#"+this.identifier)[0];return/([a-zA-Z0-9_]+)_active/.test(a.className)}else{return false}},toggle:function(){this.toggleIcon()},toggleIcon:function(){var a=$("#"+this.identifier)[0];if(/([a-zA-Z0-9_]+)_active/.test(a.className)){a.className=RegExp.$1}else{a.className=a.className+"_active"}},show:function(){$(this.domElement).show()},hide:function(){$(this.domElement).hide()},visible:function(){return this.domElement.visible()}});paella.Profiles={loadProfile:function(b,a){var c={url:"config/profiles/profiles.json"};paella.ajax.get(c,function(f,d,e){if(typeof(f)=="string"){f=JSON.parse(f)}a(f[b])},function(f,d,e){paella.debug.log("Error loading video profiles. Check your Paella Player configuration")})},loadProfileList:function(a){var b={url:"config/profiles/profiles.json"};paella.ajax.get(b,function(e,c,d){if(typeof(e)=="string"){e=JSON.parse(e)}a(e)},function(e,c,d){paella.debug.log("Error loading video profiles. Check your Paella Player configuration")})}};paella.RelativeVideoSize=Class.create({w:1280,h:720,proportionalHeight:function(a){return Math.floor(this.h*a/this.w)},proportionalWidth:function(a){return Math.floor(this.w*a/this.h)},percentVSize:function(a){return a*100/this.h},percentWSize:function(a){return a*100/this.w},aspectRatio:function(){return this.w/this.h}});paella.VideoElementBase=Class.create(paella.DomNode,{isReady:false,initialize:function(b,i,d,j,c,m){var k=this;var f=new paella.RelativeVideoSize();var l=f.percentVSize(j)+"%";var h=f.percentWSize(d)+"%";var e=f.percentWSize(c)+"%";var g=f.percentVSize(m)+"%";var a={top:l,left:h,width:e,height:g,position:"absolute",zIndex:GlobalParams.video.zIndex};this.parent(i,b,a);$(this.domElement).bind("canplay",function(n){k.ready=true})},isReady:function(){return this.ready},play:function(){paella.debug.log("TODO: implement play() function in your VideoElementBase subclass")},pause:function(){paella.debug.log("TODO: implement pause() function in your VideoElementBase subclass")},isPaused:function(){paella.debug.log("TODO: implement isPaused() function in your VideoElementBase subclass");return false},duration:function(){paella.debug.log("TODO: implement duration() function in your VideoElementBase subclass");return -1},setCurrentTime:function(a){paella.debug.log("TODO: implement setCurrentTime() function in your VideoElementBase subclass")},currentTime:function(){paella.debug.log("TODO: implement currentTime() function in your VideoElementBase subclass");return 0},setVolume:function(a){paella.debug.log("TODO: implement setVolume() function in your VideoElementBase subclass");return false},volume:function(){paella.debug.log("TODO: implement volume() function in your VideoElementBase subclass");return -1},setPlaybackRate:function(a){paella.debug.log("TODO: implement setPlaybackRate() function in your VideoElementBase subclass")},addSource:function(a){paella.debug.log("TODO: implement addSource() function in your VideoElementBase subclass")},setClassName:function(a){this.domElement.className=a},getDimensions:function(){return{width:this.domElement.videoWidth,height:this.domElement.videoHeight}},setRect:function(g,b){var d=new paella.RelativeVideoSize();var i=d.percentVSize(g.top)+"%";var e=d.percentWSize(g.left)+"%";var c=d.percentWSize(g.width)+"%";var f=d.percentVSize(g.height)+"%";var a={top:i,left:e,width:c,height:f,position:"absolute"};if(b){this.disableClassName();var h=this;$(this.domElement).animate(a,400,function(){h.enableClassName()});this.enableClassNameAfter(400)}else{$(this.domElement).css(a)}},disableClassName:function(){this.classNameBackup=this.domElement.className;this.domElement.className=""},enableClassName:function(){this.domElement.className=this.classNameBackup},enableClassNameAfter:function(a){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",a)},setClassName:function(a){this.domElement.className=a},setVisible:function(b,a){if(b=="true"&&a){$(this.domElement).animate({opacity:1},300)}else{if(b=="true"&&!a){$(this.domElement).show()}else{if(b=="false"&&a){$(this.domElement).animate({opacity:0},300)}else{if(b=="false"&&!a){$(this.domElement).hide()}}}}},setLayer:function(a){this.domElement.style.zIndex=a}});paella.FlashVideo=Class.create(paella.VideoElementBase,{classNameBackup:"",flashVideo:null,paused:true,streamingMode:true,flashId:"",initialize:function(e,d,c,b,a){this.parent(e,"div",d,c,b,a);this.flashId=e+"Movie"},isReady:function(){return true},addParameter:function(b,a,c){var d=document.createElement("param");d.setAttribute("name",a);d.setAttribute("value",c);b.appendChild(d)},createSwf:function(b,h){var e=document.createElement("object");e.setAttribute("id",this.flashId+"IE");e.setAttribute("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000");e.setAttribute("codebase",'"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=5,0,0,0"');e.setAttribute("width","100%");e.setAttribute("height","100%");this.addParameter(e,"movie",b);this.addParameter(e,"quality","high");this.addParameter(e,"bgcolor","#efefef");this.addParameter(e,"play","true");this.addParameter(e,"loop","true");this.addParameter(e,"wmode","window");this.addParameter(e,"scale","default");this.addParameter(e,"menu","true");this.addParameter(e,"devicefont","false");this.addParameter(e,"salign","");this.addParameter(e,"allowScriptAccess","sameDomain");var a=document.createElement("object");a.setAttribute("id",this.flashId);a.setAttribute("type","application/x-shockwave-flash");a.setAttribute("data",b);a.setAttribute("width","100%");a.setAttribute("height","100%");this.addParameter(a,"movie",b);this.addParameter(a,"quality","high");this.addParameter(a,"bgcolor","#efefef");this.addParameter(a,"play","true");this.addParameter(a,"loop","true");this.addParameter(a,"wmode","window");this.addParameter(a,"scale","default");this.addParameter(a,"menu","true");this.addParameter(a,"devicefont","false");this.addParameter(a,"salign","");this.addParameter(a,"allowScriptAccess","sameDomain");e.appendChild(a);var g="";var f="";for(var c in h){g+=f+c+"="+encodeURIComponent(h[c]);f="&"}this.addParameter(e,"flashvars",g);this.addParameter(a,"flashvars",g);var d=document.createElement("a");d.setAttribute("href","http://www.adobe.com/go/getflash");d.innerHTML='<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />';a.appendChild(d);return e},play:function(){if(this.flashVideo){try{this.flashVideo.play();this.paused=false;return true}catch(a){}}return false},pause:function(){if(this.flashVideo){try{this.flashVideo.pause();this.paused=true;return true}catch(a){}}return false},isPaused:function(){return this.paused},duration:function(){if(this.flashVideo){try{return this.flashVideo.duration()}catch(a){return -1}}},setCurrentTime:function(b){if(this.flashVideo){try{this.flashVideo.seekToTime(b)}catch(a){}}},currentTime:function(){if(this.flashVideo){try{return this.flashVideo.getCurrentTime()}catch(a){return 0}}return -1},setVolume:function(b){if(this.flashVideo){var a=this;try{this.flashVideo.setVolume(b);return true}catch(c){new Timer(function(e){try{a.flashVideo.setVolume(b);e.repeat=false}catch(d){paella.debug.log("Fail to set volume on "+a.identifier);e.repeat=true}},100)}}return false},volume:function(){return this.flashVideo.getVolume()},setPlaybackRate:function(a){},createSwfObject:function(c,e){var f=this.identifier;var b={wmode:"transparent"};var d=document.createElement("div");this.domElement.appendChild(d);d.id=f+"Movie";swfobject.embedSWF(c,d.id,"100%","100%","9.0.0","",e,b);var a=$("#"+d.id)[0];return a},addSourceProgresiveDownload:function(b){if(b.type=="video/mp4"){var a={};if(!/rtmp:\/\//.test(b.src)){a.url=b.src;this.flashVideo=this.createSwfObject("player.swf",a)}}else{if(b.type=="video/x-flv"){var a={};a.url=b.src;this.flashVideo=this.createSwfObject("player.swf",a)}}},addSourceStreaming:function(b){if(b.type=="video/mp4"){var a={};if(/(rtmp:\/\/[\w\d\.\-_]+[:+\d]*\/[\w\d\-_]+\/)(mp4:)([\w\d\.\/\-_]+)/i.test(b.src)){b.src=RegExp.$1+RegExp.$3}if(/(rtmp:\/\/)([\w\d\.\-_]+[:+\d]*)\/([\w\d\-_]+\/)([\w\d\.\/\-_]+)/.test(b.src)){a.connect=RegExp.$1+RegExp.$2+"/"+RegExp.$3;a.url="mp4:"+RegExp.$4}this.flashVideo=this.createSwfObject("player.swf",a)}else{if(b.type=="video/x-flv"){var a={};if(/(rtmp:\/\/)([\w\d\.\-_]+[:+\d]*)\/([\w\d\-_]+\/)([\w\d\.\/\-_]+)(\.flv)?/.test(b.src)){a.connect=RegExp.$1+RegExp.$2+"/"+RegExp.$3;a.url=RegExp.$4}this.flashVideo=this.createSwfObject("player.swf",a)}}},addSource:function(a){if(this.streamingMode){this.addSourceStreaming(a)}else{this.addSourceProgresiveDownload(a)}},getDimensions:function(){var b={width:640,height:480};try{b.width=this.flashVideo.getWidth();b.height=this.flashVideo.getHeight()}catch(a){paella.debug.log("Warning: flash video is not loaded")}return b}});paella.Html5Video=Class.create(paella.VideoElementBase,{classNameBackup:"",ready:false,initialize:function(f,e,d,c,a){this.parent(f,"video",e,d,c,a);var b=this;$(this.domElement).bind("canplay",function(g){b.ready=true})},isReady:function(){return this.ready},play:function(){if(this.domElement&&this.domElement.play){this.domElement.play()}},pause:function(){if(this.domElement&&this.domElement.pause){this.domElement.pause()}},isPaused:function(){return this.domElement.paused},duration:function(){if(this.domElement&&this.domElement.duration){return this.domElement.duration}},setCurrentTime:function(a){if(this.domElement&&this.domElement.currentTime){this.domElement.currentTime=a}},currentTime:function(){if(this.domElement&&this.domElement.currentTime){return this.domElement.currentTime}return 0},setVolume:function(a){this.domElement.volume=a;return true},volume:function(){return this.domElement.volume},setPlaybackRate:function(a){this.domElement.playbackRate=a},addSource:function(b){var c=document.createElement("source");c.src=b.src;c.type=b.type;this.domElement.appendChild(c);var a=new UserAgent();if(a.browser.IsMobileVersion){this.ready=true}},getDimensions:function(){return{width:this.domElement.videoWidth,height:this.domElement.videoHeight}},setRect:function(g,b){var d=new paella.RelativeVideoSize();var i=d.percentVSize(g.top)+"%";var e=d.percentWSize(g.left)+"%";var c=d.percentWSize(g.width)+"%";var f=d.percentVSize(g.height)+"%";var a={top:i,left:e,width:c,height:f,position:"absolute"};if(b){this.disableClassName();var h=this;$(this.domElement).animate(a,400,function(){h.enableClassName()});this.enableClassNameAfter(400)}else{$(this.domElement).css(a)}},disableClassName:function(){this.classNameBackup=this.domElement.className;this.domElement.className=""},enableClassName:function(){this.domElement.className=this.classNameBackup},enableClassNameAfter:function(a){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",a)},setVisible:function(b,a){if(b=="true"&&a){$(this.domElement).animate({opacity:1},300)}else{if(b=="true"&&!a){$(this.domElement).show()}else{if(b=="false"&&a){$(this.domElement).animate({opacity:0},300)}else{if(b=="false"&&!a){$(this.domElement).hide()}}}}},setLayer:function(a){this.domElement.style.zIndex=a}});paella.SlideshowVideo=Class.create(paella.VideoElementBase,{isReady:false,img:null,_frames:null,_duration:0,_currentTime:0,_playTime:0,_lastFrame:-1,updateTimer:null,initialize:function(f,e,d,c,a){this.parent(f,"div",e,d,c,a);this.img=document.createElement("img");this.img.style.width="100%";this.img.style.height="100%";this.domElement.appendChild(this.img);var b=this;b.ready=false},isReady:function(){return this.ready},checkFrame:function(){var e=null;var d="";var c=-1;for(var a=0;a<this._frames.length;++a){var b=this._frames[a];if(this._currentTime<b.time){break}e=b.image;d="frame_"+b.time;c=b.time}if(this._lastFrame!=c){this.img.src=e;this.img.alt=d;this._lastFrame=c}},play:function(){if(!this.updateTimer){this._playTime=new Date().getTime();this.updateTimer=new Timer(function(d,c){var b=new Date().getTime();var a=Math.round((b-c.player._playTime)/1000);c.player._currentTime+=a;c.player._playTime=b;c.player.checkFrame();if(c.player_currentTime>=c.player._duration){c.player.pause()}},1000,{player:this});this.updateTimer.repeat=true}},pause:function(){if(this.updateTimer){this.updateTimer.cancel();this.updateTimer=null}},isPaused:function(){return this.updateTimer==null},duration:function(){return _duration},setCurrentTime:function(a){if(this._duration>=a){this._currentTime=a;this.checkFrame()}},currentTime:function(){return this._currentTime},setVolume:function(a){return false},volume:function(){return -1},setPlaybackRate:function(a){},addSource:function(c){this._duration=c.duration;this._currentTime=0;this.loadFrames(c.frames,c.duration);var b=new Image();var a=this;b.onload=function(d){a.ready=true;a.checkFrame()};b.src=this._frames[0].image},loadFrames:function(d,b){this._frames=[];for(var a=0;a<b;++a){var c=d["frame_"+a];if(c){this._frames.push({time:a,image:c})}}}});paella.BackgroundContainer=Class.create(paella.DomNode,{initialize:function(b,a){this.parent("img",b,{position:"relative",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:GlobalParams.background.zIndex});this.domElement.setAttribute("src",a);this.domElement.setAttribute("alt","");this.domElement.setAttribute("width","100%");this.domElement.setAttribute("height","100%")},setImage:function(a){this.domElement.setAttribute("src",a)}});paella.VideoOverlay=Class.create(paella.DomNode,{size:{w:1280,h:720},initialize:function(){var a={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden",zIndex:10};this.parent("div","overlayContainer",a);this.domElement.setAttribute("role","main")},enableBackgroundMode:function(){this.domElement.className="overlayContainer background"},disableBackgroundMode:function(){this.domElement.className="overlayContainer"},clear:function(){this.domElement.innerHTML=""},getMasterRect:function(){return paella.player.videoContainer.getMasterVideoRect()},getSlaveRect:function(){return paella.player.videoContainer.getSlaveVideoRect()},addText:function(d,b,a){var c=document.createElement("div0");c.innerHTML=d;c.className="videoOverlayText";if(a){c.style.backgroundColor="red"}return this.addElement(c,b)},addElement:function(a,b){this.domElement.appendChild(a);a.style.position="absolute";a.style.left=this.getHSize(b.left)+"%";a.style.top=this.getVSize(b.top)+"%";a.style.width=this.getHSize(b.width)+"%";a.style.height=this.getVSize(b.height)+"%";return a},removeElement:function(a){this.domElement.removeChild(a)},getVSize:function(a){return a*100/this.size.h},getHSize:function(a){return a*100/this.size.w}});paella.VideoContainerBase=Class.create(paella.DomNode,{trimming:{enabled:false,start:0,end:0},timeupdateEventTimer:null,timeupdateInterval:250,masterVideoData:null,slaveVideoData:null,currentMasterVideoData:null,currentSlaveVideoData:null,initialize:function(b){var a={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden"};this.parent("div",b,a)},initEvents:function(){var a=this;paella.events.bind(paella.events.play,function(b){a.play();a.startTimeupdate()});paella.events.bind(paella.events.pause,function(b){a.pause();a.stopTimeupdate()});paella.events.bind(paella.events.next,function(b){a.next();a.triggerTimeupdate()});paella.events.bind(paella.events.previous,function(b){a.previous();a.triggerTimeupdate()});paella.events.bind(paella.events.seekTo,function(b,c){a.setCurrentPercent(c.newPositionPercent);a.triggerTimeupdate()});paella.events.bind(paella.events.seekToTime,function(b,c){a.setCurrentTime(c.time);a.triggerTimeupdate()});paella.events.bind(paella.events.setPlaybackRate,function(b,c){a.setPlaybackRate(c)});paella.events.bind(paella.events.setVolume,function(b,c){a.setVolume(c)});paella.events.bind(paella.events.setTrim,function(b,c){a.setTrim})},triggerTimeupdate:function(){var a=this;paella.events.trigger(paella.events.timeupdate,{videoContainer:a,currentTime:a.currentTime()})},startTimeupdate:function(){var a=this;this.timeupdateEventTimer=new Timer(function(b){a.triggerTimeupdate()},this.timeupdateInterval);this.timeupdateEventTimer.repeat=true},stopTimeupdate:function(){this.timeupdateEventTimer.repeat=false;this.timeupdateEventTimer=null},play:function(){paella.debug.log("VideoContainerBase.play()")},pause:function(){paella.debug.log("VideoContainerBase.pause()")},trimStart:function(){return 0},trimEnd:function(){return this.duration()},trimEnabled:function(){return false},enableTrimming:function(){this.trimming.enabled=true;paella.events.trigger(paella.events.setTrim,{trimEnabled:this.trimming.enabled,trimStart:this.trimming.start,trimEnd:this.trimming.end})},disableTrimming:function(){this.trimming.enabled=false;paella.events.trigger(paella.events.setTrim,{trimEnabled:this.trimming.enabled,trimStart:this.trimming.start,trimEnd:this.trimming.end})},setTrimming:function(b,a){this.trimming.start=b;this.trimming.end=a;if(this.currentTime()<this.trimming.start){this.setCurrentTime(this.trimming.start)}if(this.currentTime()>this.trimming.end){this.setCurrentTime(this.trimming.end)}paella.events.trigger(paella.events.setTrim,{trimEnabled:this.trimming.enabled,trimStart:this.trimming.start,trimEnd:this.trimming.end})},setTrimmingStart:function(a){this.setTrimming(a,this.trimming.end)},setTrimmingEnd:function(a){this.setTrimming(this.trimming.start,a)},setCurrentPercent:function(c){var f=this.trimStart();var a=this.trimEnd();var e=a-f;var b=c*e/100;var d=parseFloat(b)+parseFloat(f);this.setCurrentTime(d)},setCurrentTime:function(a){paella.debug.log("VideoContainerBase.setCurrentTime("+a+")")},currentTime:function(){paella.debug.log("VideoContainerBase.currentTime()");return 0},duration:function(){paella.debug.log("VideoContainerBase.duration()");return 0},paused:function(){paella.debug.log("VideoContainerBase.paused()");return true},setupVideo:function(a){paella.debug.log("VideoContainerBase.setupVide()")},setPlaybackRate:function(a){paella.debug.log("VideoContainerBase.setPlaybackBase("+a.rate+")")},setVolume:function(a){paella.debug.log("VideoContainerBase.setVolume("+a.master+")")},volume:function(){paella.debug.log("VideoContainerBase.volume()");return 1},isReady:function(){paella.debug.log("VideoContainerBase.isReady()");return true},onresize:function(){this.parent(onresize)}});paella.VideoContainer=Class.create(paella.VideoContainerBase,{containerId:"",video1Id:"",video2Id:"",backgroundId:"",container:null,video1ClassName:"video masterVideo",video2ClassName:"video slaveVideo",isHidden:false,maxSyncDelay:0.5,logos:null,isMasterReady:false,isSlaveReady:false,isMonostream:false,sourceData:[],overlayContainer:null,videoSyncTimeMillis:5000,currentMasterVideoRect:{},currentSlaveVideoRect:{},initialize:function(d){this.parent(d);var a=this;this.containerId=d+"_container";this.video1Id=d+"_1";this.video2Id=d+"_2";this.backgroundId=d+"_bkg";this.logos=[];this.container=new paella.DomNode("div",this.containerId,{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",width:"1024px",height:"567px"});this.container.domElement.setAttribute("role","main");this.addNode(this.container);this.overlayContainer=new paella.VideoOverlay(this.domElement);this.container.addNode(this.overlayContainer);var c=document.createElement("div");c.className="videoLoaderOverlay";this.overlayContainer.addElement(c,{left:0,top:0,width:1280,height:720});paella.events.bind(paella.events.loadComplete,function(){a.overlayContainer.clear()});this.container.addNode(new paella.BackgroundContainer(this.backgroundId,"config/profiles/resources/default_background_paella.jpg"));this.initEvents();paella.events.bind(paella.events.timeupdate,function(e){a.checkVideoTrimming()});var a=this;var b=new paella.utils.Timer(function(e){a.syncVideos()},a.videoSyncTimeMillis);b.repeat=true},getMasterVideoRect:function(){return this.currentMasterVideoRect},getSlaveVideoRect:function(){return this.currentSlaveVideoRect},createVideoPlayers:function(){var b=new paella.FlashVideo(this.video1Id,850,140,360,550);b.setClassName(this.video1ClassName);this.container.addNode(b);var a=new paella.FlashVideo(this.video2Id,10,40,800,600);a.setClassName(this.video2ClassName);a.setVolume(0);this.container.addNode(a)},setHidden:function(a){this.isHidden=a},hideVideo:function(){this.setHidden(true)},publishVideo:function(){this.setHidden(false)},syncVideos:function(){var c=this.masterVideo();var b=this.slaveVideo();if(!this.isMonostream&&c&&b&&c.currentTime&&b.currentTime){var a=Math.abs(c.currentTime()-b.currentTime());if(a>this.maxSyncDelay){paella.debug.log("Sync videos performed, diff="+a);b.setCurrentTime(c.currentTime())}}},checkVideoTrimming:function(){var c=this.currentTime();var b=this.duration();var d=0;if(this.trimming.enabled){b=this.trimming.end;d=parseFloat(this.trimming.start)}if(c>=Math.floor(b)){var a=this;paella.events.trigger(paella.events.endVideo,{videoContainer:a});this.pause()}else{if(c<d){this.setCurrentTime(d+1)}}},play:function(){var b=this.masterVideo();var a=this.slaveVideo();if(b){b.play()}if(a){a.play()}},pause:function(){var b=this.masterVideo();var a=this.slaveVideo();if(b){b.pause()}if(a){a.pause()}},next:function(){if(this.trimming.end!=0){this.setCurrentTime(this.trimming.end)}else{this.setCurrentTime(this.duration(true))}},previous:function(){this.setCurrentTime(this.trimming.start)},setCurrentTime:function(a){if(this.trimming.enabled){if(a<this.trimming.start){a=this.trimming.start}if(a>this.trimming.end){a=this.trimming.end}}var c=this.masterVideo();var b=this.slaveVideo();if(c){c.setCurrentTime(a)}if(b){b.setCurrentTime(a)}},currentTime:function(){var b=this.masterVideo();var a=this.slaveVideo();if(b){return b.currentTime()}else{if(a){return a.currentTime()}else{return 0}}},setPlaybackRate:function(a){var c=this.masterVideo();var b=this.slaveVideo();if(c){c.setPlaybackRate(a.rate)}if(b){b.setPlaybackRate(a.rate)}},setVolume:function(a){var c=this.masterVideo();var b=this.slaveVideo();if(c&&a.master){c.setVolume(a.master)}else{if(c){c.setVolume(0)}}if(b&&a.slave){b.setVolume(a.slave)}else{if(b){b.setVolume(0)}}},volume:function(a){if(!a&&this.masterVideo()){return this.masterVideo().volume()}else{if(a=="master"&&this.masterVideo()){return this.masterVideo().volume()}else{if(a=="slave"&&this.slaveVideo()){return this.slaveVideo().volume()}else{return 0}}}},masterVideo:function(){return this.container.getNode(this.video1Id)},slaveVideo:function(){return this.container.getNode(this.video2Id)},duration:function(a){if(this.trimming.enabled&&!a){return this.trimming.end-this.trimming.start}else{if(!this.videoDuration){this.videoDuration=this.masterVideo().duration()}return this.videoDuration}},paused:function(){return this.masterVideo().isPaused()},trimEnabled:function(){return this.trimming.enabled},trimStart:function(){if(this.trimming.enabled){return this.trimming.start}else{return 0}},trimEnd:function(){if(this.trimming.enabled){return this.trimming.end}else{return this.duration()}},setMasterSource:function(c,b){if(b=="html"){var d=new paella.Html5Video(this.video1Id,850,140,360,550)}else{if(b=="flash"){var d=new paella.FlashVideo(this.video1Id,850,140,360,550);d.streamingMode=false}else{if(b=="streaming"){var d=new paella.FlashVideo(this.video1Id,850,140,360,550);d.streamingMode=true}else{if(b=="image"){var d=new paella.SlideshowVideo(this.video1Id,850,140,360,550)}}}}d.setClassName(this.video1ClassName);this.container.addNode(d);var a=this;this.sourceData.push(c);this.setupVideo(d,c,b,"master");this.masterVideoData=c;new Timer(function(e){if(d.isReady()){a.isMasterReady=true;e.repeat=false}else{e.repeat=true}},100);return true},setSlaveSource:function(b,c){if(c=="html"||!b){var d=new paella.Html5Video(this.video2Id,10,40,800,600)}else{if(c=="flash"){var d=new paella.FlashVideo(this.video2Id,10,40,800,600);d.streamingMode=false}else{if(c=="streaming"){var d=new paella.FlashVideo(this.video2Id,10,40,800,600);d.streamingMode=true}else{if(c=="image"){var d=new paella.SlideshowVideo(this.video2Id,850,140,360,550)}}}}d.setClassName(this.video2ClassName);this.container.addNode(d);if(!b){setMonoStreamMode();return false}var a=this;this.sourceData.push(b);this.setupVideo(d,b,c,"slave");this.slaveVideoData=b;new Timer(function(e){if(d.isReady()){a.isSlaveReady=true;d.setVolume(0);e.repeat=false}else{e.repeat=true}},100);return true},setMonoStreamMode:function(){this.isMonoStream=true;this.isSlaveReady=true},getVideoQuality:function(a,l){if(a.length>0){var j=paella.utils.parameters.list["res"+l];var d=a[0];var m=$(window).width();var g=$(window).height();var b=(m*g);var k=parseInt(d.res.w)*parseInt(d.res.h);var f=Math.abs(b-k);for(var e=0;e<a.length;++e){var h=a[e].res;if(h){if(j!=undefined){h=h.w+"x"+h.h;if(h==j){d=a[e];break}}else{var c=parseInt(a[e].res.w)*parseInt(a[e].res.h);var n=Math.abs(b-c);if(n<f){f=n;d=a[e]}}}}return d}else{return a}},setupVideo:function(c,e,g,j){if(c&&e){var d=e.sources.mp4;var f=e.sources.ogg;var a=e.sources.webm;var k=e.sources.flv;var b=e.sources.rtmp;var i=e.sources.image;var h=null;if(g=="html"){if(d){h=d}if(f){h=f}if(a){h=a}}else{if(k&&g=="flash"){h=k}else{if(d&&g=="flash"){h=d}else{if(b&&g=="streaming"){h=b}else{if(i&&g=="image"){h=i}}}}}h=this.getVideoQuality(h,j);if(j=="master"){this.currentMasterVideoData=h}else{if(j=="slave"){this.currentSlaveVideoData=h}}c.addSource(h)}},numberOfStreams:function(){return this.sourceData.length},getMonostreamMasterProfile:function(){return{content:"presenter",visible:true,layer:1,rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},]}},getMonostreamSlaveProfile:function(){return{content:"slides",visible:false,layer:0,rect:[{aspectRatio:"16/9",left:0,top:0,width:0,height:0},{aspectRatio:"4/3",left:0,top:0,width:0,height:0},]}},setProfile:function(b,c){var a=this;paella.Profiles.loadProfile(b,function(d){if(a.numberOfStreams()==1){d.masterVideo=a.getMonostreamMasterProfile();d.slaveVideo=a.getMonostreamSlaveProfile()}a.applyProfileWithJson(d);c(b);paella.utils.cookies.set("lastProfile",b)})},isReady:function(){return this.isMasterReady&&this.isSlaveReady},hideAllLogos:function(){for(var a=0;a<this.logos.length;++a){var b=this.logos[a];var c=this.container.getNode(b);$(c.domElement).hide()}},showLogos:function(e){var g=new paella.RelativeVideoSize();for(var f=0;f<e.length;++f){var c=e[f];var m=c.content;var b=this.container.getNode(m);var k=c.rect;if(!b){a={};b=this.container.addNode(new paella.DomNode("img",m,a));b.domElement.setAttribute("src","config/profiles/resources/"+m);b.domElement.setAttribute("src","config/profiles/resources/"+m)}else{$(b.domElement).show()}var l=g.percentVSize(k.top)+"%";var j=g.percentWSize(k.left)+"%";var d=g.percentWSize(k.width)+"%";var h=g.percentVSize(k.height)+"%";var a={top:l,left:j,width:d,height:h,position:"absolute",zIndex:c.zIndex};$(b.domElement).css(a)}},applyProfileWithJson:function(e){var t=this.container.getNode(this.video1Id);var q=this.container.getNode(this.video2Id);var r=this.container.getNode(this.backgroundId);var k=e.masterVideo.rect[0];var c=e.slaveVideo.rect[0];var m=t.getDimensions();var a={width:360,height:240};if(q){a=q.getDimensions()}var g=(m.height==0)?1.3333:m.width/m.height;var n=(a.height==0)?1.3333:a.width/a.height;var o=1.333;var f=1.333;var h=10;for(var p=0;p<e.masterVideo.rect.length;++p){var d=e.masterVideo.rect[p];if(/([0-9]+)\/([0-9]+)/.test(d.aspectRatio)){o=Number(RegExp.$1)/Number(RegExp.$2)}var l=Math.abs(o-g);if(h>l){h=l;k=d}}var b=10;for(var p=0;p<e.slaveVideo.rect.length;++p){var s=e.slaveVideo.rect[p];if(/([0-9]+)\/([0-9]+)/.test(s.aspectRatio)){f=Number(RegExp.$1)/Number(RegExp.$2)}var j=Math.abs(f-n);if(b>j){b=j;c=s}}this.hideAllLogos();this.showLogos(e.logos);t.setRect(k,true);this.currentMasterVideoRect=k;t.setVisible(e.masterVideo.visible,true);if(q){q.setRect(c,true);this.currentSlaveVideoRect=c;q.setVisible(e.slaveVideo.visible,true);q.setLayer(e.slaveVideo.layer)}t.setLayer(e.masterVideo.layer);r.setImage("config/profiles/resources/"+e.background.content)},resizePortrail:function(){var c=$(this.domElement).width();var e=new paella.RelativeVideoSize();var a=e.proportionalHeight(c);this.container.domElement.style.width=c+"px";this.container.domElement.style.height=a+"px";var d=$(this.domElement).height();var b=d/2-a/2;this.container.domElement.style.top=b+"px"},resizeLandscape:function(){var a=$(this.domElement).height();var c=new paella.RelativeVideoSize();var b=c.proportionalWidth(a);this.container.domElement.style.width=b+"px";this.container.domElement.style.height=a+"px";this.container.domElement.style.top="0px"},onresize:function(){this.parent();var e=new paella.RelativeVideoSize();var d=e.aspectRatio();var c=$(this.domElement).width();var a=$(this.domElement).height();var b=c/a;if(b>d){this.resizeLandscape()}else{this.resizePortrail()}}});paella.PluginManager=Class.create({targets:null,pluginList:new Array(),eventDrivenPlugins:new Array(),initialize:function(){this.targets={};var a=this;paella.events.bind(paella.events.loadPlugins,function(b){a.loadPlugins()})},setTarget:function(b,a){if(a.addPlugin){this.targets[b]=a}},getTarget:function(b){if(b=="eventDriven"){return this}else{var a=this.targets[b];return a}},registerPlugin:function(a){this.pluginList.push(a);this.pluginList.sort(function(d,c){return d.getIndex()-c.getIndex()})},loadPlugins:function(){var f=paella.player.config.plugins;if(!f){f={defaultConfig:{enabled:true},list:{}}}for(var d=0;d<this.pluginList.length;++d){var e=this.pluginList[d];var b=e.getName();var a=f.list[b];if(!a){a=f.defaultConfig}else{for(var c in f.defaultConfig){if(a[c]===undefined){a[c]=f.defaultConfig[c]}}}if((a&&a.enabled)||!a){paella.debug.log("loading plugin "+b);e.config=a;e.load(this)}}},addPlugin:function(b){var a=this;b.checkEnabled(function(f){if(b.type=="eventDriven"&&f){b.setup();a.eventDrivenPlugins.push(b);var e=b.getEvents();for(var d=0;d<e.length;++d){var c=e[d];paella.events.bind(c,function(g,h){b.onEvent(g.type,h)})}}})},getPlugin:function(a){for(var b=0;b<this.pluginList.length;++b){if(this.pluginList[b].getName()==a){return this.pluginList[b]}}return null}});paella.pluginManager=new paella.PluginManager();paella.Plugin=Class.create({type:"",initialize:function(){var a=this;paella.pluginManager.registerPlugin(this)},load:function(b){var a=b.getTarget(this.type);if(a&&a.addPlugin){a.addPlugin(this)}},getRootNode:function(a){return null},checkEnabled:function(a){a(true)},setup:function(){},getIndex:function(){return 0},getName:function(){return""}});paella.PopUpContainer=Class.create(paella.DomNode,{containers:null,currentContainerId:-1,initialize:function(d,b){var c=this;var a={};this.parent("div",d,a);this.domElement.className=b;this.containers={};paella.events.bind(paella.events.hidePopUp,function(e,f){c.hideContainer(f.identifier,f.button)});paella.events.bind(paella.events.showPopUp,function(e,f){c.showContainer(f.identifier,f.button)})},hideContainer:function(b,c){var a=this.containers[b];if(a&&this.currentContainerId==b){a.plugin.willHideContent();$(a.element).hide();a.button.className=a.button.className.replace(" selected","");$(this.domElement).css({width:"0px"});this.currentContainerId=-1;a.plugin.didHideContent()}},showContainer:function(b,d){var a=this.containers[b];var c=$(d.parentElement).width()-$(d).position().left-$(d).width();if(a&&this.currentContainerId!=b&&this.currentContainerId!=-1){var f=this.containers[this.currentContainerId];f.plugin.willHideContent();f.button.className=f.button.className.replace(" selected","");a.button.className=a.button.className+" selected";$(f.element).hide();f.plugin.didHideContent();a.plugin.willShowContent();$(a.element).show();var e=$(a.element).width();$(this.domElement).css({width:e+"px",right:c+"px"});this.currentContainerId=b;a.plugin.didShowContent()}else{if(a&&this.currentContainerId==b){a.plugin.willHideContent();$(a.element).hide();$(this.domElement).css({width:"0px"});a.button.className=a.button.className.replace(" selected","");this.currentContainerId=-1;a.plugin.didHideContent()}else{if(a){a.button.className=a.button.className+" selected";a.plugin.willShowContent();$(a.element).show();var e=$(a.element).width();$(this.domElement).css({width:e+"px",right:c+"px"});this.currentContainerId=b;a.plugin.didShowContent()}}}},registerContainer:function(b,e,c,d){var a={button:c,element:e,plugin:d};this.containers[b]=a;$(e).hide();c.popUpIdentifier=b;c.sourcePlugin=d;$(c).click(function(f){paella.events.trigger(paella.events.showPopUp,{identifier:this.popUpIdentifier,button:this})});$(c).keyup(function(f){if((f.keyCode==13)&&(!this.plugin.isPopUpOpen())){paella.events.trigger(paella.events.showPopUp,{identifier:this.popUpIdentifier,button:this})}else{if((f.keyCode==27)){paella.events.trigger(paella.events.hidePopUp,{identifier:this.popUpIdentifier,button:this})}}});d.containerManager=this}});paella.TimelineContainer=Class.create(paella.PopUpContainer,{hideContainer:function(b,c){var a=this.containers[b];if(a&&this.currentContainerId==b){a.plugin.willHideContent();$(a.element).hide();a.button.className=a.button.className.replace(" selected","");this.currentContainerId=-1;$(this.domElement).css({height:"0px"});a.plugin.didHideContent()}},showContainer:function(c,d){var b=this.containers[c];if(b&&this.currentContainerId!=c&&this.currentContainerId!=-1){var e=this.containers[this.currentContainerId];e.button.className=e.button.className.replace(" selected","");b.button.className=b.button.className+" selected";e.plugin.willHideContent();$(e.element).hide();e.plugin.didHideContent();b.plugin.willShowContent();$(b.element).show();this.currentContainerId=c;var a=$(b.element).height();$(this.domElement).css({height:a+"px"});b.plugin.didShowContent()}else{if(b&&this.currentContainerId==c){b.plugin.willHideContent();$(b.element).hide();b.button.className=b.button.className.replace(" selected","");$(this.domElement).css({height:"0px"});this.currentContainerId=-1;b.plugin.didHideContent()}else{if(b){b.plugin.willShowContent();b.button.className=b.button.className+" selected";$(b.element).show();this.currentContainerId=c;var a=$(b.element).height();$(this.domElement).css({height:a+"px"});b.plugin.didShowContent()}}}}});paella.ButtonPlugin=Class.create(paella.Plugin,{type:"button",subclass:"",container:null,containerManager:null,getAlignment:function(){return"left"},getSubclass:function(){return"myButtonPlugin"},action:function(a){},getName:function(){return"ButtonPlugin"},getMinWindowSize:function(){return 0},buildContent:function(a){},willShowContent:function(){paella.debug.log(this.getName()+" willDisplayContent")},didShowContent:function(){paella.debug.log(this.getName()+" didDisplayContent")},willHideContent:function(){paella.debug.log(this.getName()+" willHideContent")},didHideContent:function(){paella.debug.log(this.getName()+" didHideContent")},getButtonType:function(){return paella.ButtonPlugin.type.actionButton},hideButton:function(){this.button.setAttribute("aria-hidden","false");$(this.button).hide()},showButton:function(){this.button.setAttribute("aria-hidden","true");$(this.button).show()},changeSubclass:function(a){this.subclass=a;this.container.className=this.getClassName()},getClassName:function(){return paella.ButtonPlugin.kClassName+" "+this.getAlignment()+" "+this.subclass},getContainerClassName:function(){if(this.getButtonType()==paella.ButtonPlugin.type.timeLineButton){return paella.ButtonPlugin.kTimeLineClassName+" "+this.getSubclass()}else{if(this.getButtonType()==paella.ButtonPlugin.type.popUpButton){return paella.ButtonPlugin.kPopUpClassName+" "+this.getSubclass()}}},setToolTip:function(a){this.button.setAttribute("title",a);this.button.setAttribute("aria-label",a)},getDefaultToolTip:function(){return""},isPopUpOpen:function(){return(this.button.popUpIdentifier==this.containerManager.currentContainerId)}});paella.ButtonPlugin.alignment={left:"left",right:"right"};paella.ButtonPlugin.kClassName="buttonPlugin";paella.ButtonPlugin.kPopUpClassName="buttonPluginPopUp";paella.ButtonPlugin.kTimeLineClassName="buttonTimeLine";paella.ButtonPlugin.type={actionButton:1,popUpButton:2,timeLineButton:3};paella.ButtonPlugin.buildPluginButton=function(b,c){b.subclass=b.getSubclass();var a=document.createElement("div");a.className=b.getClassName();a.id=c;a.setAttribute("tabindex",1000+b.getIndex());a.setAttribute("alt","");a.setAttribute("role","button");a.plugin=b;b.button=a;b.container=a;b.setToolTip(b.getDefaultToolTip());$(a).click(function(d){this.plugin.action(this)});$(a).keyup(function(d){if(d.keyCode==13){this.plugin.action(this)}});return a};paella.ButtonPlugin.buildPluginPopUp=function(a,c,d){c.subclass=c.getSubclass();var b=document.createElement("div");a.appendChild(b);b.className=c.getContainerClassName();b.id=d;b.plugin=c;c.buildContent(b);return b};paella.VideoOverlayButtonPlugin=Class.create(paella.ButtonPlugin,{type:"videoOverlayButton",getSubclass:function(){return"myVideoOverlayButtonPlugin"},action:function(a){},getName:function(){return"VideoOverlayButtonPlugin"}});paella.EventDrivenPlugin=Class.create(paella.Plugin,{type:"eventDriven",initialize:function(){this.parent();var b=this.getEvents();for(var a=0;a<b.length;++a){var c=b[a];if(c==paella.events.loadStarted){this.onEvent(paella.events.loadStarted)}}},getEvents:function(){return new Array()},onEvent:function(a,b){},getName:function(){return"EventDrivenPlugin"}});paella.TimeControl=Class.create(paella.DomNode,{initialize:function(b){this.parent("div",b,{left:"0%"});this.domElement.className="timeControlOld";this.domElement.className="timeControl";var a=this;paella.events.bind(paella.events.timeupdate,function(c,d){a.onTimeUpdate(d)})},onTimeUpdate:function(a){var b=a.videoContainer;var g={start:0,end:b.duration};var f={start:b.trimStart(),end:b.trimEnd()};var d=a.currentTime-f.start;var e=f.end-f.start;var c=d*100/e;if(this.domElement.className=="timeControlOld"){this.domElement.style.left=c+"%"}this.domElement.innerHTML=this.secondsToHours(parseInt(d))},secondsToHours:function(b){var a=Math.floor(b/3600);var c=Math.floor((b-(a*3600))/60);var d=b-(a*3600)-(c*60);if(a<10){a="0"+a}if(c<10){c="0"+c}if(d<10){d="0"+d}return a+":"+c+":"+d}});paella.PlaybackBar=Class.create(paella.DomNode,{playbackFullId:"",updatePlayBar:true,timeControlId:"",initialize:function(d){var c={};this.parent("div",d,c);this.domElement.className="playbackBar";this.domElement.setAttribute("alt","");this.domElement.setAttribute("title","Timeline Slider");this.domElement.setAttribute("aria-label","Timeline Slider");this.domElement.setAttribute("role","slider");this.domElement.setAttribute("aria-valuemin","0");this.domElement.setAttribute("aria-valuemax","100");this.domElement.setAttribute("aria-valuenow","0");this.domElement.setAttribute("tabindex","1100");$(this.domElement).keyup(function(f){switch(f.keyCode){case 37:var g=100*paella.player.videoContainer.currentTime()/paella.player.videoContainer.duration();var e=g-5;paella.events.trigger(paella.events.seekTo,{newPositionPercent:e});break;case 39:var g=100*paella.player.videoContainer.currentTime()/paella.player.videoContainer.duration();var e=g+5;paella.events.trigger(paella.events.seekTo,{newPositionPercent:e});break}});this.playbackFullId=d+"_full";this.timeControlId=d+"_timeControl";var b=new paella.DomNode("div",this.playbackFullId,{width:"0%"});b.domElement.className="playbackBarFull";this.addNode(b);this.addNode(new paella.TimeControl(this.timeControlId));var a=this;paella.events.bind(paella.events.timeupdate,function(e,f){a.onTimeUpdate(f)});$(this.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e);e.stopPropagation()});$(b.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e);e.stopPropagation()});$(this.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)});$(b.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)});$(this.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)});$(b.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)})},playbackFull:function(){return this.getNode(this.playbackFullId)},timeControl:function(){return this.getNode(this.timeControlId)},setPlaybackPosition:function(a){this.playbackFull().domElement.style.width=a+"%"},isSeeking:function(){return !this.updatePlayBar},onTimeUpdate:function(a){if(this.updatePlayBar){var b=a.videoContainer;var f={start:0,end:b.duration};var e={start:b.trimStart(),end:b.trimEnd()};var c=a.currentTime-e.start;var d=e.end-e.start;this.setPlaybackPosition(c*100/d)}},down:function(b,a,c){this.updatePlayBar=false;this.move(b,a,c)},move:function(d,a,e){var c=$(this.domElement).width();var b=a-$(this.domElement).offset().left;if(b<0){b=0}else{if(b>c){b=100}else{b=b*100/c}}this.setPlaybackPosition(b)},up:function(d,a,e){var c=$(this.domElement).width();var b=a-$(this.domElement).offset().left;if(b<0){b=0}else{if(b>c){b=100}else{b=b*100/c}}paella.events.trigger(paella.events.seekTo,{newPositionPercent:b});this.updatePlayBar=true}});paella.PlaybackControl=Class.create(paella.DomNode,{playbackBarId:"",pluginsContainer:null,popUpPluginContainer:null,timeLinePluginContainer:null,playbackPluginsWidth:0,popupPluginsWidth:0,minPlaybackBarSize:120,playbackBarInstance:null,buttonPlugins:[],addPlugin:function(c){var a=this;var d="buttonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(c);var b=paella.ButtonPlugin.buildPluginButton(c,d);c.button=b;this.pluginsContainer.domElement.appendChild(b);$(b).hide();c.checkEnabled(function(g){if(g){$(c.button).show();c.setup();var i="buttonPlugin"+a.buttonPlugins.length;if(c.getButtonType()==paella.ButtonPlugin.type.popUpButton){var f=a.popUpPluginContainer.domElement;var e=paella.ButtonPlugin.buildPluginPopUp(f,c,i+"_container");a.popUpPluginContainer.registerContainer(c.getName(),e,b,c)}else{if(c.getButtonType()==paella.ButtonPlugin.type.timeLineButton){var f=a.timeLinePluginContainer.domElement;var h=paella.ButtonPlugin.buildPluginPopUp(f,c,i+"_timeline");a.timeLinePluginContainer.registerContainer(c.getName(),h,b,c)}}}else{a.pluginsContainer.domElement.removeChild(c.button)}})},initialize:function(c){var b={};this.parent("div",c,b);this.domElement.className="playbackControls";this.playbackBarId=c+"_playbackBar";var a=this;this.pluginsContainer=new paella.DomNode("div",c+"_playbackBarPlugins");this.pluginsContainer.domElement.className="playbackBarPlugins";this.pluginsContainer.domElement.setAttribute("role","toolbar");this.addNode(this.pluginsContainer);this.popUpPluginContainer=new paella.PopUpContainer(c+"_popUpPluginContainer","popUpPluginContainer");this.addNode(this.popUpPluginContainer);this.timeLinePluginContainer=new paella.TimelineContainer(c+"_timelinePluginContainer","timelinePluginContainer");this.addNode(this.timeLinePluginContainer);this.addNode(new paella.PlaybackBar(this.playbackBarId));paella.pluginManager.setTarget("button",this)},playbackBar:function(){if(this.playbackBarInstance==null){this.playbackBarInstance=this.getNode(this.playbackBarId)}return this.playbackBarInstance},onresize:function(){paella.debug.log("resize playback bar");var a=$(this.domElement).width();for(var b=0;b<this.buttonPlugins.length;++b){var c=this.buttonPlugins[b];var d=c.getMinWindowSize();if(d>0&&a<d){$(c.container).hide()}else{$(c.container).show()}}}});paella.ControlsContainer=Class.create(paella.DomNode,{playbackControlId:"",editControlId:"",isEnabled:true,autohideTimer:null,hideControlsTimeMillis:3000,playbackControlInstance:null,videoOverlayButtons:null,buttonPlugins:[],addPlugin:function(c){var a=this;var d="videoOverlayButtonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(c);var b=paella.ButtonPlugin.buildPluginButton(c,d);this.videoOverlayButtons.domElement.appendChild(b);c.button=b;$(b).hide();c.checkEnabled(function(e){if(e){$(c.button).show();c.setup()}})},initialize:function(b){this.parent("div",b);this.viewControlId=b+"_view";this.playbackControlId=b+"_playback";this.editControlId=b+"_editor";this.addNode(new paella.PlaybackControl(this.playbackControlId));var a=this;paella.events.bind(paella.events.showEditor,function(c){a.onShowEditor()});paella.events.bind(paella.events.hideEditor,function(c){a.onHideEditor()});paella.events.bind(paella.events.play,function(c){a.onPlayEvent()});paella.events.bind(paella.events.pause,function(c){a.onPauseEvent()});paella.events.bind("mousemove",function(c){a.onMouseMoveEvent()});paella.events.bind(paella.events.endVideo,function(c){a.onEndVideoEvent()});paella.events.bind("keydown",function(c){a.onKeyEvent()});this.videoOverlayButtons=new paella.DomNode("div",b+"_videoOverlayButtonPlugins");this.videoOverlayButtons.domElement.className="videoOverlayButtonPlugins";this.videoOverlayButtons.domElement.setAttribute("role","toolbar");this.addNode(this.videoOverlayButtons);paella.pluginManager.setTarget("videoOverlayButton",this)},onShowEditor:function(){var a=this.editControl();if(a){$(a.domElement).hide()}},onHideEditor:function(){var a=this.editControl();if(a){$(a.domElement).show()}},enterEditMode:function(){var b=this.playbackControl();var a=this.editControl();if(b&&a){$(b.domElement).hide()}},exitEditMode:function(){var b=this.playbackControl();var a=this.editControl();if(b&&a){$(b.domElement).show()}},playbackControl:function(){if(this.playbackControlInstance==null){this.playbackControlInstance=this.getNode(this.playbackControlId)}return this.playbackControlInstance},editControl:function(){return this.getNode(this.editControlId)},disable:function(){this.isEnabled=false;this.hide()},enable:function(){this.isEnabled=true;this.show()},hide:function(){var b=this;var a=new UserAgent();if(!a.browser.IsMobileVersion){$(this.domElement).animate({opacity:0},{duration:300,complete:function(){b.domElement.setAttribute("aria-hidden","true")}});paella.events.trigger(paella.events.controlBarWillHide)}else{paella.debug.log("Mobile version: controls will not hide")}},show:function(){if(this.isEnabled){if(this.domElement.style.opacity!=1){this.domElement.style.opacity=1;this.domElement.setAttribute("aria-hidden","false");paella.events.trigger(paella.events.controlBarDidShow)}}},autohideTimeout:function(){var a=this.playbackControl().playbackBar();if(a.isSeeking()){this.restartAutohideTimer()}else{this.hideControls()}},hideControls:function(){this.hide()},showControls:function(){this.show()},onPlayEvent:function(){this.restartAutohideTimer()},onPauseEvent:function(){this.clearAutohideTimer()},onEndVideoEvent:function(){this.show();this.clearAutohideTimer()},onKeyEvent:function(){this.showControls();if(paella.player.videoContainer.isReady()&&!paella.player.videoContainer.paused()){this.restartAutohideTimer()}},onMouseMoveEvent:function(){this.showControls();if(paella.player.videoContainer.isReady()&&!paella.player.videoContainer.paused()){this.restartAutohideTimer()}},clearAutohideTimer:function(){if(this.autohideTimer!=null){this.autohideTimer.cancel();this.autohideTimer=null}},restartAutohideTimer:function(){this.clearAutohideTimer();var a=this;this.autohideTimer=new paella.utils.Timer(function(b){a.autohideTimeout()},this.hideControlsTimeMillis)},onresize:function(){this.playbackControl().onresize()}});paella.LoaderContainer=Class.create(paella.DomNode,{timer:null,loader:null,loaderPosition:0,initialize:function(b){this.parent("div",b,{position:"fixed",backgroundColor:"white",opacity:"0.7",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:10000});this.loader=this.addNode(new paella.DomNode("div","",{position:"fixed",width:"128px",height:"128px",top:"50%",left:"50%",marginLeft:"-64px",marginTop:"-64px",backgroundImage:"url(resources/images/loader.png)"}));var a=this;paella.events.bind(paella.events.loadComplete,function(c,d){a.loadComplete(d)});this.timer=new paella.utils.Timer(function(c){a.loaderPosition-=128;a.loader.domElement.style.backgroundPosition=a.loaderPosition+"px";c.timeout=c.timeout*2},1000);this.timer.repeat=true},loadComplete:function(a){$(this.domElement).hide();this.timer.repeat=false}});paella.KeyManager=Class.create({isPlaying:false,Keys:{Space:32,Left:37,Up:38,Right:39,Down:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},enabled:true,initialize:function(){var a=this;paella.events.bind(paella.events.loadComplete,function(b,c){a.loadComplete(b,c)});paella.events.bind(paella.events.play,function(b){a.onPlay()});paella.events.bind(paella.events.pause,function(b){a.onPause()})},loadComplete:function(b,c){var a=this;paella.events.bind("keyup",function(d){a.keyUp(d)})},onPlay:function(){this.isPlaying=true},onPause:function(){this.isPlaying=false},keyUp:function(a){if(!this.enabled){return}if(a.altKey&&a.ctrlKey){if(a.which==this.Keys.P){this.togglePlayPause()}else{if(a.which==this.Keys.S){this.pause()}else{if(a.which==this.Keys.M){this.mute()}else{if(a.which==this.Keys.U){this.volumeUp()}else{if(a.which==this.Keys.D){this.volumeDown()}}}}}}else{if(a.which==this.Keys.Space){this.togglePlayPause()}else{if(a.which==this.Keys.Up){this.volumeUp()}else{if(a.which==this.Keys.Down){this.volumeDown()}else{if(a.which==this.Keys.M){this.mute()}}}}}},togglePlayPause:function(){if(this.isPlaying){paella.events.trigger(paella.events.pause)}else{paella.events.trigger(paella.events.play)}},pause:function(){paella.events.trigger(paella.events.pause)},mute:function(){var a=paella.player.videoContainer;var b=0;if(a.volume()==0){b=1}paella.events.trigger(paella.events.setVolume,{master:b,slave:0})},volumeUp:function(){var a=paella.player.videoContainer;var b=a.volume();b+=0.1;b=(b>1)?1:b;paella.events.trigger(paella.events.setVolume,{master:b,slave:0})},volumeDown:function(){var a=paella.player.videoContainer;var b=a.volume();b-=0.1;b=(b<0)?0:b;paella.events.trigger(paella.events.setVolume,{master:b,slave:0})}});paella.keyManager=new paella.KeyManager();paella.AccessControl=Class.create({permissions:{canRead:false,canContribute:false,canWrite:false,loadError:true,isAnonymous:false},userData:{username:"",name:"",lastname:"",avatar:"",},checkAccess:function(a){a(this.permissions)}});paella.DefaultAccessControl=Class.create(paella.AccessControl,{checkAccess:function(a){this.permissions.canRead=false;this.permissions.canContribute=false;this.permissions.canWrite=false;this.permissions.loadError=false;this.permissions.isAnonymous=true;this.userData.username="anonymous";this.userData.name="Anonymous";this.userData.avatar="resources/images/default_avatar.png";a(this.permissions)}});paella.VideoLoader=Class.create({streams:[],frameList:[],loadStatus:false,codecStatus:false,isH264Capable:function(){var b=document.createElement("video");var a=b.canPlayType('video/mp4; codecs="avc1.42E01E"');if(a==""){a=b.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}a=(a=="probably")||(a=="maybe");return a},isOggCapable:function(){if(paella.utils.userAgent.browser.IsMobileVersion){return false}var a=document.createElement("video");var b=a.canPlayType('video/ogg; codecs="theora"');b=(b=="probably")||(b=="maybe");return b},isWebmCapable:function(){if(paella.utils.userAgent.browser.IsMobileVersion){return false}var a=document.createElement("video");var b=a.canPlayType('video/webm; codecs="vp8, vorbis"');b=(b=="probably")||(b=="maybe");return b},isImageCapable:function(){return true},isHtmlVideoCompatible:function(e){var a=false;if(this.streams.length>e){var d=this.streams[e];var b=this.isH264Capable();var f=this.isOggCapable();var c=this.isWebmCapable();paella.debug.log("Browser video capabilities: mp4="+((b)?"yes":"no")+", ogg="+((f)?"yes":"no")+", webm="+((c)?"yes":"no"));if(d.sources.mp4&&b&&!/rtmp:\/\//.test(d.sources.mp4.src)){a=true}else{if(d.sources.ogg&&f){a=true}else{if(d.sources.webm&&c){a=true}}}}return a},isImageCompatible:function(c){var a=false;if(this.streams.length>c){var b=this.streams[c];if(b.sources.image){a=true}}return a},isFlashCompatible:function(d){var b=new UserAgent();var a=false;if(this.streams.length>d){var c=this.streams[d];if(c.sources.mp4){a=true}else{if(c.sources.flv){a=true}}}return a&&!b.browser.IsMobileVersion},isStreamingCompatible:function(d){var b=new UserAgent();var a=false;if(this.streams.length>d){var c=this.streams[d];if(c.sources.rtmp){a=true}else{a=false}}return a&&!b.browser.IsMobileVersion},isStreamCompatible:function(b,c){var a=false;if(c.name=="html"&&this.isHtmlVideoCompatible(b)){a=true}else{if(c.name=="flash"&&this.isFlashCompatible(b)){a=true}else{if(c.name=="streaming"&&this.isStreamingCompatible(b)){a=true}else{if(c.name=="image"&&this.isImageCompatible(b)){a=true}}}}return a},getPreferredMethod:function(e){var d=new UserAgent();var c=null;var a=paella.player.config.player.methods;if(d.browser.IsMobileVersion&&e>=1){for(var b=0;b<a.length;++b){if(a[b].name=="image"&&a[b].enabled&&this.isStreamCompatible(e,a[b])){c=a[b]}}}else{for(var b=0;b<a.length;++b){if(this.isStreamCompatible(e,a[b])){c=a[b];break}}}return c},loadVideo:function(a,b){b()}});paella.PlayerBase=Class.create({config:null,playerId:"",mainContainer:null,videoContainer:null,controls:null,accessControl:null,checkCompatibility:function(){if(paella.utils.parameters.get("ignoreBrowserCheck")){return true}var c=new UserAgent();if(c.browser.IsMobileVersion){return true}if(c.browser.Chrome||c.browser.Safari||c.browser.Firefox||c.browser.Opera||(c.browser.Explorer&&c.browser.Version.major>=9)){return true}else{var a=paella.dictionary.translate("It seems that your browser is not HTML 5 compatible");paella.events.trigger(paella.events.error,{error:a});var b=a+'<div style="display:block;width:470px;height:140px;margin-left:auto;margin-right:auto;font-family:Verdana,sans-sherif;font-size:12px;"><a href="http://www.google.es/chrome" style="color:#004488;float:left;margin-right:20px;"><img src="resources/images/chrome.png" style="width:80px;height:80px" alt="Google Chrome"></img><p>Google Chrome</p></a><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home" style="color:#004488;float:left;margin-right:20px;"><img src="resources/images/explorer.png" style="width:80px;height:80px" alt="Internet Explorer 9"></img><p>Internet Explorer 9</p></a><a href="http://www.apple.com/safari/" style="float:left;margin-right:20px;color:#004488"><img src="resources/images/safari.png" style="width:80px;height:80px" alt="Safari"></img><p>Safari 5</p></a><a href="http://www.mozilla.org/firefox/" style="float:left;color:#004488"><img src="resources/images/firefox.png" style="width:80px;height:80px" alt="Firefox"></img><p>Firefox 12</p></a></div>';b+='<div style="margin-top:30px;"><a id="ignoreBrowserCheckLink" href="#" onclick="window.location = window.location + \'&ignoreBrowserCheck=true\'">'+paella.dictionary.translate("Continue anyway")+"</a></div>";paella.messageBox.showError(b,{height:"40%"})}return false},initialize:function(b){if(!this.checkCompatibility()){paella.debug.log("It seems that your browser is not HTML 5 compatible")}else{paella.player=this;this.playerId=b;this.mainContainer=$("#"+this.playerId)[0];this.accessControl=paella.initDelegate.initParams.accessControl;var a=this;paella.events.bind(paella.events.loadComplete,function(c,d){a.loadComplete(c,d)})}},includePlugins:function(b,f,g,c){if(!c){c="plugins/plugins.css"}if(/debug/.test(window.location.href)){paella.debug.debug=true;for(var e=0;e<g.length;e++){var d=g[e];var a=d.substr(0,d.lastIndexOf("."))+".css";paella.debug.log(f+d+", "+f+a);paella.utils.require(f+d);paella.utils.importStylesheet(f+a)}}else{paella.utils.importStylesheet(c)}},loadComplete:function(a,b){}});paella.InitDelegate=Class.create({initParams:{configUrl:"config/config.json",dictionaryUrl:"config/dictionary",editorDictionaryUrl:"config/editor_dictionary",accessControl:new paella.DefaultAccessControl(),videoLoader:new paella.VideoLoader()},initialize:function(b){if(b){for(var a in b){this.initParams[a]=b[a]}}},getId:function(){return paella.utils.parameters.get("id")},loadDictionary:function(b){var a=new paella.AsyncLoader();a.addCallback(new paella.DictionaryCallback(this.initParams.dictionaryUrl));a.addCallback(new paella.DictionaryCallback(this.initParams.editorDictionaryUrl));a.load(function(){b()},function(){b()})},loadConfig:function(c){var a=this.initParams.configUrl;var b={};b.url=a;paella.ajax.get(b,function(g,f,d){if(typeof(g)=="string"){try{g=JSON.parse(g)}catch(h){c({})}}paella.dictionary.addDictionary(g);c(g)},function(f,e,d){c({})})},loadEditorConfig:function(b){var a={cssPath:"resources/ui/jquery-ui.css"};b(a)}});var paellaPlayer=null;paella.plugins={};paella.plugins.events={};paella.initDelegate=null;var PaellaPlayer=Class.create(paella.PlayerBase,{player:null,selectedProfile:"",videoIdentifier:"",editor:null,loader:null,videoData:null,setProfile:function(b){var a=this;this.videoContainer.setProfile(b,function(c){a.selectedProfile=c})},initialize:function(b){this.parent(b);if(this.playerId==b){this.loadPaellaPlayer();this.includePlugins("javascript/paella_plugins.js","plugins/",paella.pluginList);var a=this;paella.events.bind(paella.events.setProfile,function(c,d){a.setProfile(d.profileName)})}},loadPaellaPlayer:function(){var a=this;this.loader=new paella.LoaderContainer("paellaPlayer_loader");$("body")[0].appendChild(this.loader.domElement);paella.events.trigger(paella.events.loadStarted);paella.initDelegate.loadDictionary(function(){paella.initDelegate.loadConfig(function(b){a.onLoadConfig(b)})})},onLoadConfig:function(a){paella.data=new paella.Data(a);this.config=a;this.videoIdentifier=paella.initDelegate.getId();if(this.videoIdentifier){if(this.mainContainer){this.videoContainer=new paella.VideoContainer(this.playerId+"_videoContainer");this.controls=new paella.ControlsContainer(this.playerId+"_controls");this.mainContainer.appendChild(this.videoContainer.domElement);this.mainContainer.appendChild(this.controls.domElement)}$(window).resize(function(b){paella.player.onresize()});this.onload()}},onload:function(){var a=this;this.accessControl.checkAccess(function(c){if(!c.loadError){paella.debug.log("read:"+c.canRead+", contribute:"+c.canContribute+", write:"+c.canWrite);if(c.canWrite){paella.events.bind(paella.events.showEditor,function(d){a.showEditor()});paella.events.bind(paella.events.hideEditor,function(d){a.hideEditor()})}if(c.canRead){a.loadVideo();a.videoContainer.publishVideo()}else{a.unloadAll(paella.dictionary.translate("You are not authorized to view this resource"))}}else{if(c.isAnonymous){var b=paella.dictionary.translate("You are not logged in");a.unloadAll(b);paella.events.trigger(paella.events.error,{error:b})}else{var b=paella.dictionary.translate("You are not authorized to view this resource");a.unloadAll(b);paella.events.trigger(paella.events.error,{error:b})}}})},onresize:function(){this.videoContainer.onresize();this.controls.onresize();if(this.editor){this.editor.resize()}},unloadAll:function(a){$("#playerContainer")[0].innerHTML="";var b=$("#paellaPlayer_loader")[0];paella.messageBox.showError(a)},showEditor:function(){new paella.editor.Editor()},hideEditor:function(){},loadVideo:function(){if(this.videoIdentifier){var b=this;var a=paella.initDelegate.initParams.videoLoader;this.onresize();a.loadVideo(this.videoIdentifier,function(){var g=a.streams[0];var e=a.streams[1];var i=a.frameList;if(a.loadStatus){var h=a.getPreferredMethod(0);var d=a.getPreferredMethod(1);var c=true;if(h){c=paella.player.videoContainer.setMasterSource(g,h.name)}if(d){c=paella.player.videoContainer.setSlaveSource(e,d.name)}else{paella.player.videoContainer.setMonoStreamMode()}if(c){paella.events.trigger(paella.events.loadPlugins,{pluginManager:paella.pluginManager});new paella.utils.Timer(function(j){if(b.videoContainer.isReady()){paella.events.trigger(paella.events.loadComplete,{masterVideo:g,slaveVideo:e,frames:i});b.onresize();j.repeat=false}else{j.repeat=true}},500)}else{var f=paella.dictionary.translate("Your browser is not compatible with the required video codec");paella.messageBox.showError(f);paella.events.trigger(paella.events.error,{error:f})}}else{var f=paella.dictionary.translate("Error loading video data");paella.messageBox.showError(f);paella.events.trigger(paella.events.error,{error:f})}})}},loadPreviews:function(){var e=paella.initDelegate.initParams.videoLoader.streams;var b=null;var c=e[0].preview;if(e.length>=2){b=e[1].preview}if(c){var a=paella.player.videoContainer.overlayContainer.getMasterRect();this.masterPreviewElem=document.createElement("img");this.masterPreviewElem.src=c;paella.player.videoContainer.overlayContainer.addElement(this.masterPreviewElem,a)}if(b){var d=paella.player.videoContainer.overlayContainer.getSlaveRect();this.slavePreviewElem=document.createElement("img");this.slavePreviewElem.src=b;paella.player.videoContainer.overlayContainer.addElement(this.slavePreviewElem,d)}paella.events.bind(paella.events.timeUpdate,function(f){paella.player.unloadPreviews()})},unloadPreviews:function(){if(this.masterPreviewElem){paella.player.videoContainer.overlayContainer.removeElement(this.masterPreviewElem);this.masterPreviewElem=null}if(this.slavePreviewElem){paella.player.videoContainer.overlayContainer.removeElement(this.slavePreviewElem);this.slavePreviewElem=null}},loadComplete:function(c,f){var a=this;var e=paella.utils.parameters.get("time");var b=paella.player.videoContainer.masterVideo();var d=paella.utils.parameters.get("profile");var g=paella.utils.cookies.get("lastProfile");if(d){this.setProfile(d)}else{if(g){this.setProfile(g)}else{this.setProfile(this.config.defaultProfile)}}paella.events.trigger(paella.events.play);new paella.utils.Timer(function(i){var k=paella.utils.parameters.list.autoplay?paella.utils.parameters.list.autoplay:"";k=k.toLowerCase();if(k!="true"&&k!="yes"){paella.events.trigger(paella.events.pause)}if(e){var m=b.duration();var q=a.videoContainer.trimStart();var p=a.videoContainer.trimEnd();if(a.videoContainer.trimEnabled()){m=p-q}var n=0;var l=0;var j=0;if(/([0-9]+)h/.test(e)){n=Number(RegExp.$1)}if(/([0-9]+)m/.test(e)){l=Number(RegExp.$1)}if(/([0-9]+)s/.test(e)){j=Number(RegExp.$1)}var h=n*60*60+l*60+j;var o=h*100/m;paella.events.trigger(paella.events.seekTo,{newPositionPercent:o})}a.loadPreviews();if(paella.player.config.editor&&paella.player.config.editor.enabled&&paella.player.config.editor.loadOnStartup){paella.events.trigger(paella.events.showEditor)}},1000)}});function initPaellaEngage(a,b){if(!b){b=new paella.InitDelegate()}paella.initDelegate=b;var c=navigator.language||window.navigator.userLanguage;paellaPlayer=new PaellaPlayer(a,paella.initDelegate)};paella.ExtendedPlugin=Class.create(paella.Plugin,{type:"extendedPlugin",getName:function(){return"es.upv.paella.extended.Plugin"},checkEnabled:function(a){a(paella.extended!=null)},getIndex:function(){return 10000}});paella.RightBarPlugin=Class.create(paella.ExtendedPlugin,{type:"rightBarPlugin",getName:function(){return"es.upv.paella.extended.RightBarPlugin"},buildContent:function(a){}});paella.TabBarPlugin=Class.create(paella.ExtendedPlugin,{type:"tabBarPlugin",getName:function(){return"es.upv.paella.extended.TabBarPlugin"},getTabName:function(){return"New Tab"},action:function(a){},buildContent:function(a){},setToolTip:function(a){this.button.setAttribute("title",a);this.button.setAttribute("aria-label",a)},getDefaultToolTip:function(){return""}});paella.Extended=Class.create({container:null,paellaHeader:null,paellaContainer:null,rightContainer:null,bottomContainer:null,settings:{containerId:"paellaExtendedContainer",paellaHeaderId:"playerHeader",paellaContainerId:"playerContainer",rightContainerId:"paella_right",bottomContainerId:"paella_bottom",containerClass:"paellaExtendedContainer",playerHeaderClass:"playerHeader",playerContainerClass:"playerContainer",rightContainerClass:"rightContainer",bottomContainerClass:"bottomContainer",aspectRatio:1.777777,initDelegate:new paella.InitDelegate({accessControl:new paella.AccessControl(),videoLoader:new paella.VideoLoader})},rightBarPlugins:[],tabBarPlugins:[],currentTabIndex:0,bottomContainerTabs:null,bottomContainerContent:null,initialize:function(b){this.saveSettings(b);this.loadPaellaExtended();var a=this;$(window).resize(function(c){a.onresize()})},saveSettings:function(b){if(b){for(var a in b){this.settings[a]=b[a]}}},loadPaellaExtended:function(){this.container=$("#"+this.settings.containerId)[0];if(!this.container){var a=$("body")[0];a.innerHTML="";this.container=document.createElement("div");this.container.id=this.settings.containerId;this.container.className=this.settings.containerClass;a.appendChild(this.container)}else{this.container.innerHTML="";this.container.className=this.settings.containerClass}this.paellaHeader=document.createElement("div");this.paellaHeader.id=this.settings.paellaHeaderId;this.paellaHeader.className=this.settings.playerHeaderClass;this.container.appendChild(this.paellaHeader);this.paellaContainer=document.createElement("div");this.paellaContainer.id=this.settings.paellaContainerId;this.paellaContainer.className=this.settings.playerContainerClass;this.container.appendChild(this.paellaContainer);this.rightContainer=document.createElement("div");this.rightContainer.id=this.settings.rightContainerId;this.rightContainer.className=this.settings.rightContainerClass;this.container.appendChild(this.rightContainer);this.bottomContainer=document.createElement("div");this.bottomContainer.id=this.settings.bottomContainerId;this.bottomContainer.className=this.settings.bottomContainerClass;this.container.appendChild(this.bottomContainer);var c=document.createElement("div");c.id="bottomContainer_tabs";c.className="bottomContainerTabs";this.bottomContainerTabs=c;this.bottomContainer.appendChild(c);var d=document.createElement("div");d.id="bottomContainer_content";d.className="bottomContainerContent";this.bottomContainerContent=d;this.bottomContainer.appendChild(d);var b=this;$(document).bind(paella.events.loadComplete,function(e,f){b.setMainProfile()});this.initPlugins();initPaellaEngage(this.paellaContainer.id,this.settings.initDelegate);this.onresize()},initPlugins:function(){paella.pluginManager.setTarget("rightBarPlugin",this);paella.pluginManager.setTarget("tabBarPlugin",this)},addPlugin:function(b){var a=this;b.checkEnabled(function(c){if(c){b.setup();if(b.type=="rightBarPlugin"){a.rightBarPlugins.push(b);a.addRightBarPlugin(b)}if(b.type=="tabBarPlugin"){a.tabBarPlugins.push(b);a.addTabPlugin(b)}}})},showTab:function(a){for(var b=0;b<this.tabBarPlugins.length;++b){var d=$("#tab_"+b)[0];var c=$("#tab_content_"+b)[0];if(b==a){d.className="bottomContainerTabItem enabledTabItem";c.className="bottomContainerContent enabledTabContent"}else{d.className="bottomContainerTabItem disabledTabItem";c.className="bottomContainerContent disabledTabContent"}}},addTabPlugin:function(d){var a=this.currentTabIndex;var e=document.createElement("div");e.id="tab_"+a;e.className="bottomContainerTabItem disabledTabItem";e.innerHTML=d.getTabName();e.plugin=d;var b=this;$(e).click(function(f){if(/disabledTabItem/.test(this.className)){b.showTab(a);this.plugin.action(this)}});$(e).keyup(function(f){if(f.keyCode==13){if(/disabledTabItem/.test(this.className)){b.showTab(a);this.plugin.action(this)}}});this.bottomContainerTabs.appendChild(e);var c=document.createElement("div");c.id="tab_content_"+a;c.className="bottomContainerContent disabledTabContent "+d.getSubclass();this.bottomContainerContent.appendChild(c);d.buildContent(c);d.button=e;d.container=c;d.button.setAttribute("tabindex",3000+d.getIndex());d.button.setAttribute("alt","");d.setToolTip(d.getDefaultToolTip());if(this.firstTabShown===undefined){this.showTab(a);this.firstTabShown=true}++this.currentTabIndex},addRightBarPlugin:function(b){var a=document.createElement("div");a.className="rightBarPluginContainer "+b.getSubclass();this.rightContainer.appendChild(a);b.buildContent(a)},setMainProfile:function(){var a="full";var b=paella.utils.cookies.get("paella.extended.profile");if(b){a=b}else{if((paella)&&(paella.player)&&(paella.player.config)&&(paella.player.config.player)&&(paella.player.config.player.defaultProfile)){a=paella.player.config.player.defaultProfile}}this.setProfile(a)},setProfile:function(b){paella.utils.cookies.set("paella.extended.profile",b);var a=this;this.container.className=this.settings.containerClass+" "+b;this.paellaHeader.className=this.settings.playerHeaderClass+" "+b;this.paellaContainer.className=this.settings.playerContainerClass+" "+b;this.rightContainer.className=this.settings.rightContainerClass+" "+b;this.bottomContainer.className=this.settings.bottomContainerClass+" "+b;this.onresize();if(paella.player){paella.player.onresize()}},getProfile:function(){var a=new RegExp(this.settings.containerClass+" ([a-zA-Z0-9]+)");if(a.test(paella.extended.container.className)){return RegExp.$1}return""},onresize:function(){}});function initPaellaExtended(a){paella.extended=new paella.Extended(a)};paella.editor={};paella.editor.utils={mouse:{mouseDownTarget:"",}};var bootstrapUtils={elem:function(c,e,b){var d=document.createElement(c);for(var a in e){d.setAttribute(a,e[a])}if(b){d.innerHTML=b}return d},append:function(a,b){a.appendChild(b);return b},navbar:function(d,a){var c=this.elem("div",{"class":"navbar tiny "+a});var b=this.append(c,this.elem("div",{"class":"navbar-inner tiny"}));if(d){this.append(b,this.elem("div",{"class":"brand",href:"JavaScript:void(0);"},d))}return c},dropdown:function(f,a,b,c,e,d){return this.dropButton(f,a,b,c,e,d,"")},dropup:function(f,a,b,c,e,d){return this.dropButton(f,a,b,c,e,d,"dropup")},dropButton:function(j,b,g,n,i,m,h){var f="";if(m){f="pull-right"}var e=this.elem("div",{"class":"btn-group "+h+" "+b+" "+f});if(i){j='<i class="'+i+'"></i>&nbsp;<span class="text">'+j+"</span>&nbsp;"}else{j='&nbsp;<span class="text">'+j+"</span>&nbsp;"}var a=this.append(e,this.elem("a",{"class":"btn dropdown-toggle "+n,"data-toggle":"dropdown",href:"JavaScript:void(0);"},j+'<span class="caret"></span>'));var d=this.append(e,this.elem("ul",{"class":"dropdown-menu"}));for(var l in g){var c=g[l];var k=this.append(d,this.elem("li"));this.append(k,this.elem("a",{href:"JavaScript:void(0);",onclick:c,"class":"listItem"},l))}return e},buttonGroup:function(d,c,f){var e=document.createElement("div");e.className="btn-group";for(var b=0;b<d.length;++b){var a=document.createElement("button");a.className="btn "+c;a.innerHTML=d[b].label;a.buttonData=d[b];a.buttonData.disabledClass=a.className;a.title=d[b].hint;if(f){$(a).click(function(g){this.buttonData.onclick(this.buttonData)})}else{$(a).click(function(h){for(var g=0;g<this.parentNode.childNodes.length;++g){this.parentNode.childNodes[g].className=this.buttonData.disabledClass}this.className=this.className+" active";this.buttonData.onclick(this.buttonData)})}e.appendChild(a)}return e},button:function(b,d,e,a){var c=document.createElement("button");c.className="btn "+d;c.innerHTML=b;c.title=e;$(c).click(function(f){a(this)});return c}};paella.editor.PluginSaveCallback=Class.create(paella.AsyncLoaderCallback,{plugin:null,initialize:function(a){this.parent("pluginSaveCallback");this.plugin=a},load:function(b,a){this.plugin.onSave(function(){b()})}});paella.editor.PluginDiscardCallback=Class.create(paella.AsyncLoaderCallback,{plugin:null,initialize:function(a){this.parent("pluginDiscardCallback");this.plugin=a},load:function(b,a){this.plugin.onDiscard(function(){b()})}});paella.editor.PluginManager=Class.create({trackPlugins:[],rightBarPlugins:[],toolbarPlugins:[],initialize:function(){this.initPlugins()},initPlugins:function(){paella.pluginManager.setTarget("editorTrackPlugin",this);paella.pluginManager.setTarget("editorRightBarPlugin",this);paella.pluginManager.setTarget("editorToolbarPlugin",this)},addPlugin:function(b){var a=this;b.checkEnabled(function(c){if(c){b.setup();if(b.type=="editorTrackPlugin"){a.trackPlugins.push(b)}if(b.type=="editorRightBarPlugin"){a.rightBarPlugins.push(b)}if(b.type=="editorToolbarPlugin"){a.toolbarPlugins.push(b)}}})},onTrackChanged:function(a){for(var b=0;b<this.rightBarPlugins.length;++b){var c=this.rightBarPlugins[b];c.onTrackSelected(a)}for(var b=0;b<this.toolbarPlugins.length;++b){var c=this.toolbarPlugins[b];c.onTrackSelected(a)}},onSave:function(c){var b=new paella.AsyncLoader();for(var a=0;a<this.trackPlugins.length;++a){b.addCallback(new paella.editor.PluginSaveCallback(this.trackPlugins[a]))}for(var a=0;a<this.rightBarPlugins.length;++a){b.addCallback(new paella.editor.PluginSaveCallback(this.rightBarPlugins[a]))}for(var a=0;a<this.toolbarPlugins.length;++a){b.addCallback(new paella.editor.PluginSaveCallback(this.toolbarPlugins[a]))}b.load(function(){paella.events.trigger(paella.events.didSaveChanges);c(true)},function(){c(false)})},onDiscard:function(c){var b=new paella.AsyncLoader();for(var a=0;a<this.trackPlugins.length;++a){b.addCallback(new paella.editor.PluginDiscardCallback(this.trackPlugins[a]))}for(var a=0;a<this.rightBarPlugins.length;++a){b.addCallback(new paella.editor.PluginDiscardCallback(this.rightBarPlugins[a]))}for(var a=0;a<this.toolbarPlugins.length;++a){b.addCallback(new paella.editor.PluginDiscardCallback(this.toolbarPlugins[a]))}b.load(function(){c(true)},function(){c(false)})}});paella.editor.pluginManager=new paella.editor.PluginManager();paella.editor.EditorPlugin=Class.create(paella.Plugin,{onTrackSelected:function(a){if(a){paella.debug.log(this.getName()+": New track selected "+a.getName())}else{paella.debug.log("No track selected")}},onSave:function(a){a()},onDiscard:function(a){a()},contextHelpString:function(){return""}});paella.editor.TrackPlugin=Class.create(paella.editor.EditorPlugin,{type:"editorTrackPlugin",getIndex:function(){return 10000},getName:function(){return"editorTrackPlugin"},getTrackName:function(){return"My Track"},getColor:function(){return"#5500FF"},getTextColor:function(){return"#F0F0F0"},getTrackType:function(){return"secondary"},getTrackItems:function(){var a=[{id:1,s:10,e:70},{id:2,s:110,e:340}];return a},allowResize:function(){return true},allowDrag:function(){return true},allowEditContent:function(){return true},onTrackChanged:function(c,b,a){paella.events.trigger(paella.events.documentChanged)},onTrackContentChanged:function(b,a){paella.events.trigger(paella.events.documentChanged)},onSelect:function(a){paella.debug.log("Track list selected: "+this.getTrackName())},onUnselect:function(){paella.debug.log("Track list unselected: "+this.getTrackName())},onDblClick:function(a){},getTools:function(){return[]},onToolSelected:function(a){paella.events.trigger(paella.events.documentChanged)},isToolEnabled:function(a){return true},buildToolTabContent:function(a){},getSettings:function(){return null}});paella.editor.MainTrackPlugin=Class.create(paella.editor.TrackPlugin,{getTrackType:function(){return"master"},getTrackItems:function(){var a=[{id:1,s:30,e:470}];return a},getName:function(){return"editorMainTrackPlugin"},});paella.editor.RightBarPlugin=Class.create(paella.editor.EditorPlugin,{type:"editorRightBarPlugin",getIndex:function(){return 10000},getName:function(){return"editorRightbarPlugin"},getTabName:function(){return"My Rightbar Plugin"},getContent:function(){var a=document.createElement("div");a.innerHTML="Rightbar plugin";return a},onLoadFinished:function(){}});paella.editor.EditorToolbarPlugin=Class.create(paella.editor.EditorPlugin,{type:"editorToolbarPlugin",trackList:[],getIndex:function(){return 10000},getName:function(){return"editorToolbarPlugin"},getButtonName:function(){return"Toolbar Plugin"},getIcon:function(){return"icon-edit"},getOptions:function(){return[]},onOptionSelected:function(a){}});paella.editor.Tabbar=Class.create({navbar:null,container:null,initialize:function(a){this.navbar=bootstrapUtils.navbar("","navbar-inverse");a.appendChild(this.navbar);this.container=$(this.navbar).find(".navbar-inner")[0]}});paella.editor.Toolbar=Class.create({navbar:null,container:null,toolButton:null,selectedToolUtils:null,editorMenu:null,toolbarPlugins:null,initialize:function(a){this.navbar=bootstrapUtils.navbar("","navbar-inverse");a.appendChild(this.navbar);this.container=$(this.navbar).find(".navbar-inner")[0];this.buildTrackTools();this.buildPlaybackControls();this.buildEditorMenu();this.buildPlugins()},buildTrackTools:function(){var h=paella.dictionary.translate("Selection");var g={};g[h]="paella.editor.instance.bottomBar.toolbar.onToolChanged('select','"+h+"')";var a=paella.editor.pluginManager.trackPlugins;for(var d in a){var e=a[d];var c=e.getTrackName();var f="paella.editor.instance.bottomBar.toolbar.onToolChanged('"+e.getName()+"','"+e.getTrackName()+"')";g[c]=f}var b=paella.dictionary.translate("Tool")+": "+paella.dictionary.translate("Selection");this.toolButton=bootstrapUtils.dropdown(b,"toolDropdown",g,"btn-mini","",false);this.container.appendChild(this.toolButton);this.selectedToolUtils=document.createElement("span");this.selectedToolUtils.className="editorToolbar_selectedToolUtils";this.container.appendChild(this.selectedToolUtils)},buildPlaybackControls:function(){var b=document.createElement("span");b.className="editorToolbarPlaybackControls";this.container.appendChild(b);var a=[];a.push({label:'<i class="icon-step-backward icon-white"></i>',hint:"",onclick:function(c){$(document).trigger(paella.events.seekTo,{newPositionPercent:0})}});a.push({label:'<i class="icon-play icon-white"></i>',hint:"",onclick:function(c){$(document).trigger(paella.events.play)}});a.push({label:'<i class="icon-pause icon-white"></i>',hint:"",onclick:function(c){$(document).trigger(paella.events.pause)}});a.push({label:'<i class="icon-step-forward icon-white"></i>',hint:"",onclick:function(c){$(document).trigger(paella.events.seekTo,{newPositionPercent:99})}});b.appendChild(bootstrapUtils.buttonGroup(a,"btn-mini",true))},buildPlugins:function(){if(!this.toolbarPlugins){this.toolbarPlugins=document.createElement("span");this.container.appendChild(this.toolbarPlugins)}else{this.toolbarPlugins.innerHTML=""}var c=paella.editor.pluginManager.toolbarPlugins;for(var e=0;e<c.length;++e){var g=c[e];var h=g.getName();var a=g.getButtonName();var l=g.getOptions();var b={};var k=g.getIcon();if(k){k=k+" icon-white"}for(var d=0;d<l.length;++d){b[l[d]]="paella.editor.instance.bottomBar.toolbar.selectPluginOption('"+h+"',"+d+")"}var f=bootstrapUtils.dropdown(a,"editorDropdown",b,"btn-mini",k,true);this.toolbarPlugins.appendChild(f)}},buildEditorMenu:function(){var a={};a[paella.dictionary.translate("Save and close editor")]="paella.editor.instance.bottomBar.toolbar.saveAndClose();";a[paella.dictionary.translate("Save changes")]="paella.editor.instance.bottomBar.toolbar.save();";a[paella.dictionary.translate("Discard changes and close")]="paella.editor.instance.bottomBar.toolbar.discardAndClose();";this.editorMenu=bootstrapUtils.dropdown(paella.dictionary.translate("Paella Editor"),"editorDropdown",a,"btn-mini","icon-edit icon-white",true);this.container.appendChild(this.editorMenu)},selectPluginOption:function(e,d){var a=paella.editor.pluginManager.toolbarPlugins;for(var b=0;b<a.length;++b){var c=a[b];if(c.getName()==e){c.onOptionSelected(d)}}this.buildPlugins()},onToolChanged:function(b,a){paella.editor.instance.bottomBar.timeline.selectTrackList(b);var c=$(this.toolButton).find(".text")[0];c.innerHTML=paella.dictionary.translate("Tool")+": "+a;this.setupTrackTool(b)},setupTrackTool:function(d){this.selectedToolUtils.innerHTML="";var c=null;for(var b=0;b<paella.editor.pluginManager.trackPlugins.length;++b){c=paella.editor.pluginManager.trackPlugins[b];if(d==c.getName()){break}else{c=null}}if(c){var a=[];var f=c.getTools();for(var b=0;b<f.length;++b){a.push({label:f[b].label,plugin:c,toolName:f[b].name,hint:f[b].hint,onclick:function(g){if(g.plugin.onToolSelected(g.toolName)){paella.editor.instance.bottomBar.timeline.rebuildTrack(c.getName());paella.editor.pluginManager.onTrackChanged(c);paella.editor.instance.rightBar.updateCurrentTab()}}})}if(a.length>0){var e=document.createElement("span");e.innerHTML="&nbsp;"+paella.dictionary.translate("Options")+":";this.selectedToolUtils.appendChild(e);this.selectedToolUtils.appendChild(bootstrapUtils.buttonGroup(a,"btn-mini"))}}},saveAndClose:function(){paella.editor.pluginManager.onSave(function(a){paella.editor.instance.unloadEditor()})},save:function(){paella.editor.pluginManager.onSave(function(){})},discardAndClose:function(){paella.editor.pluginManager.onDiscard(function(a){paella.debug.log("Discard changes");paella.editor.instance.unloadEditor()})}});paella.editor.Timeline=Class.create({container:null,containerMinHeight:133,content:null,timeMarks:null,tracks:null,zoom:100,trackItemList:null,trackItemIndex:{back:5,front:10},trackItemOpacity:{back:0.5,front:0.9},currentTrackList:null,initialize:function(a){var b=this.containerMinHeight;this.trackItemList=[];this.container=document.createElement("div");this.container.className="editorTimelineContainer";$(this.container).css({height:b+"px"});a.appendChild(this.container);this.content=document.createElement("div");this.content.className="editorTimelineContent";$(this.content).css({width:this.zoom+"%",height:"100%"});this.container.appendChild(this.content);this.timeMarks=document.createElement("div");this.timeMarks.className="editorTimeLineTimeMarks";this.content.appendChild(this.timeMarks);this.buildTimeMarks();this.tracks=document.createElement("div");this.tracks.className="editorTimeLineTracks";this.tracks.style.minHeight=this.containerMinHeight+"px";this.content.appendChild(this.tracks);this.loadPlugins();this.setupCursors()},setupCursors:function(){var c=document.createElement("div");c.className="editorTimelineCursor";this.container.appendChild(c);var b=this.content;$(this.container).mousemove(function(f){var i=paella.player.videoContainer.duration(true);var e=$(b).width();var d=$(b).position().left;var h=f.pageX-d;$(c).css({left:h+"px"});var g=h*i/e;c.innerHTML=paella.utils.timeParse.secondsToTime(g)});var a=document.createElement("div");a.className="editorTimelineCursor currentTime";this.container.appendChild(a);$(document).bind(paella.events.timeUpdate,function(f,i){var h=paella.player.videoContainer.duration(true);var d=$(b).width();var e=i.currentTime;var g=e*d/h;$(a).css({left:g+"px"});a.innerHTML=paella.utils.timeParse.secondsToTime(e)});$(document).bind(paella.events.seekToTime,function(f,i){var h=paella.player.videoContainer.duration(true);var d=$(b).width();var e=i.time;var g=e*d/h;$(a).css({left:g+"px"});a.innerHTML=paella.utils.timeParse.secondsToTime(e)});$(this.container).mouseup(function(f){if(paella.editor.utils.mouse.mouseDownTarget!="track"){var i=paella.player.videoContainer.duration(true);var e=$(b).width();var d=$(b).position().left;var h=f.pageX-d;var g=h*100/e;$(document).trigger(paella.events.seekTo,{newPositionPercent:g})}})},loadPlugins:function(){var e=this;var d=this.tracks;d.innerHTML="";var c=paella.editor.pluginManager.trackPlugins;var g=0;var b="";for(var f in c){if(c[f].getTrackType()=="secondary"){b="track"+g;++g}else{b=""}var a=new paella.editor.Track(d,c[f],b);this.trackItemList.push(a)}this.selectTrackList(this.currentTrackList)},rebuildTrack:function(d){var b=paella.editor.pluginManager.trackPlugins;for(var c in this.trackItemList){var a=this.trackItemList[c];if(a.getName()==d){a.rebuild()}}},getHeight:function(){if($(this.container).height()<this.containerMinHeight){return this.containerMinHeight}else{return $(this.container).height()}},buildTimeMarks:function(){var k=this.zoom;this.timeMarks.innerHTML="";var n=$(this.timeMarks).width();var f=paella.player.videoContainer.duration(true);var c=70;var l=Math.ceil(n/c);var b=f/l;var j=n%c;var m=true;var a=0;for(var g=0;g<l;++g){var e=document.createElement("div");e.className="editorTimeLineMark";if(m){e.className=e.className+" odd"}if(g==(l-1)){c=j;e.className+=" last"}e.style.width=c+"px";e.innerHTML=paella.utils.timeParse.secondsToTime(a);a+=b;this.timeMarks.appendChild(e);var h=0;var d=c-h;e.style.width=d+"px";m=!m}},setZoom:function(b){var a=this;this.zoom=b;this.timeMarks.innerHTML="";$(this.content).animate({width:b+"%"},{complete:function(){a.buildTimeMarks()}})},onresize:function(){this.buildTimeMarks();var a=$(this.tracks).outerHeight();if(paella.utils.userAgent.system.Windows){var b=$(this.tracks).outerHeight()-$(this.tracks).height();a=a+b-3}$(this.container).css("height",a+"px")},selectTrackList:function(g,e,b){if(g=="select"){this.currentTrackList=null}else{for(var d in this.trackItemList){var c=this.trackItemList[d];var a=c.container;if(c.getName()==g){this.currentTrackList=c;$(a).css({"z-index":this.trackItemIndex.front,opacity:this.trackItemOpacity.front})}else{$(a).css({"z-index":this.trackItemIndex.back,opacity:this.trackItemOpacity.back})}}}var f=null;if(this.currentTrackList){f=this.currentTrackList.plugin;if(b>0){this.currentTrackList.selectTrack(b,e)}}if(!e){paella.editor.pluginManager.onTrackChanged(f);paella.editor.instance.rightBar.updateCurrentTab()}},focusTrackListItem:function(c,f){this.selectTrackList(c,true,f);var b=$("#"+paella.editor.TrackUtils.buildTrackItemId(c,f))[0];if(b){var e=paella.editor.instance.bottomBar.timeline.container.scrollLeft;var d=$(b).offset().left-10;var a=e+d;$(paella.editor.instance.bottomBar.timeline.container).animate({scrollLeft:a},{duration:100})}}});paella.editor.BottomToolbar=Class.create({container:null,content:null,initialize:function(a){this.container=document.createElement("div");this.container.className="editorBottomToolbarContainer";a.appendChild(this.container);this.content=document.createElement("div");this.container.appendChild(this.content);this.content.appendChild(bootstrapUtils.dropup("Zoom","zoomDropup",{"100%":"paella.editor.instance.bottomBar.timeline.setZoom(100)","200%":"paella.editor.instance.bottomBar.timeline.setZoom(200)","500%":"paella.editor.instance.bottomBar.timeline.setZoom(200)","1000%":"paella.editor.instance.bottomBar.timeline.setZoom(1000)","3000%":"paella.editor.instance.bottomBar.timeline.setZoom(3000)","5000%":"paella.editor.instance.bottomBar.timeline.setZoom(5000)"},"btn-mini","icon-search",true))}});paella.editor.BottomBar=Class.create(paella.AsyncLoaderCallback,{editor:null,container:null,toolbar:null,timeline:null,bottomToolbar:null,initialize:function(){this.editor=paella.editor.instance},load:function(c,b){var a=this;this.container=document.createElement("div");this.container.className="paellaEditorBottomBar";this.editor.editorContainer.appendChild(this.container);this.build();c()},build:function(){this.toolbar=new paella.editor.Toolbar(this.container);this.timeline=new paella.editor.Timeline(this.container);this.bottomToolbar=new paella.editor.BottomToolbar(this.container)},getHeight:function(){return $(this.container).height()},onresize:function(){this.timeline.onresize()}});paella.editor.RightBar=Class.create(paella.AsyncLoaderCallback,{editor:null,container:null,tabBar:null,selectedTab:0,tabContent:null,initialize:function(){this.editor=paella.editor.instance},load:function(b,a){this.container=document.createElement("div");this.container.className="paellaEditorRightBar";this.container.style.width=this.getWidth()+"px";this.container.style.bottom=this.editor.bottomBar.getHeight()+"px";this.editor.editorContainer.appendChild(this.container);this.tabBar=new paella.editor.Tabbar(this.container);this.tabContent=document.createElement("div");this.tabContent.className="paellaEditorRightBarContent";this.container.appendChild(this.tabContent);this.loadPlugins();b()},loadPlugins:function(){var c=this;var b=this.tabBar.container;b.innerHTML="";var e=document.createElement("ul");e.className="nav";var g="active";var a=paella.editor.pluginManager.rightBarPlugins;if(a.length>0){var d=0;for(var d in a){var f=a[d];e.appendChild(this.getTab(f,d));++d}b.appendChild(e);var h=a[this.selectedTab];this.tabContent.innerHTML="";this.tabContent.appendChild(h.getContent());h.onLoadFinished()}},getTab:function(f,e){var d=this;var g="";if(e==this.selectedTab){g="active"}var b=document.createElement("li");b.className=g;var c=document.createElement("a");c.className="rightBarPlugin";c.setAttribute("href","JavaScript:void(0);");c.innerHTML='<span class="editorRightBarTabIcon '+f.getName()+'"></span>'+f.getTabName();c.tabIndex=e;$(c).click(function(a){d.loadTab(this.tabIndex)});b.appendChild(c);return b},updateCurrentTab:function(){if(this.tabBar){this.loadPlugins()}},getWidth:function(){return 300},loadTab:function(a){this.selectedTab=a;this.loadPlugins()},onresize:function(){this.container.style.bottom=this.editor.bottomBar.getHeight()+"px"}});paella.editor.TrackUtils={buildTrackItemId:function(b,a){return"paellaEditorTrack_"+b+"_"+a},};paella.editor.Track=Class.create({container:null,plugin:null,trackIndex:{back:10,front:20},trackOpacity:{back:0.7,front:1},trackElemList:null,buildTrackItemId:function(b,a){return paella.editor.TrackUtils.buildTrackItemId(b,a)},initialize:function(d,c,b){this.trackElemList=[];this.plugin=c;var a=document.createElement("div");this.container=a;d.appendChild(a);this.buildTracks(a);type=c.getTrackType();if(type=="master"){a.className="editorTrackListItem master "+b}else{if(type=="secondary"){a.className="editorTrackListItem secondary "+b}}},getName:function(){return this.plugin.getName()},rebuild:function(){this.container.innerHTML="";this.buildTracks(this.container)},buildTracks:function(a){var c=this.plugin;var e=c.getTrackItems();for(var b in e){var d=this.getTrack(e[b]);this.trackElemList.push(d);this.container.appendChild(d)}},getTrack:function(d){var k=this;var h=this.plugin;var f=paella.player.videoContainer.duration(true);d.d=d.e-d.s;var c=document.createElement("div");c.className="editorTrackItem "+h.getName();c.id=this.buildTrackItemId(h.getName(),d.id);var a=d.s*100/f;var b=d.d*100/f;$(c).css({left:a+"%",width:b+"%","background-color":h.getColor(),opacity:this.trackOpacity.back});c.trackInfo={trackData:d,plugin:h};var j=document.createElement("div");if(d.name&&d.name!=""){j.innerHTML=d.name}else{j.innerHTML=h.getTrackName()}j.className="editorTrackItemLabel "+this.plugin.getTrackType();j.style.color=h.getTextColor();c.appendChild(j);if(!d.lock){if(h.allowResize()){var i=document.createElement("div");i.className="editorTrackItemResizer left";i.track=c;c.appendChild(i);var e=document.createElement("div");e.className="editorTrackItemResizer right";e.track=c;c.appendChild(e);$(i).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"L",m)});$(e).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"R",m)})}if(h.allowDrag()){var g=document.createElement("div");g.className="editorTrackItemMoveArea";g.track=c;c.appendChild(g);$(g).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"M",m)})}}else{var l=document.createElement("i");l.className="editorTrackItemLock icon-lock icon-white";c.appendChild(l)}$(c).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onTrackDown(this,m)});$(document).mousemove(function(m){k.onResizerMove(m)});$(document).mouseup(function(m){paella.editor.utils.mouse.mouseDownTarget="";k.onResizerUp(this.track,m)});$(c).dblclick(function(m){k.onDblClick(this.trackInfo,m)});return c},currentTrack:null,resizeTrack:null,currentResizer:null,lastPos:{x:0,y:0},selectTrack:function(d,a){if(typeof(d)=="number"){for(var b=0;b<this.trackElemList.length;++b){var c=this.trackElemList[b];if(c.trackInfo.trackData.id==d){d=c;break}}}if(typeof(d)!="number"&&this.currentTrack!=d){if(!a){this.onUnselect()}for(var b=0;b<this.trackElemList.length;++b){var c=this.trackElemList[b];if(c==d){this.currentTrack=c;if(!a){this.onSelect(c.trackInfo)}$(c).css({"z-index":this.trackIndex.front,opacity:this.trackOpacity.front})}else{$(c).css({"z-index":this.trackIndex.back,opacity:this.trackOpacity.back})}}}},onSelect:function(a){this.plugin.onSelect(a.trackData)},onDblClick:function(a,b){this.plugin.onDblClick(a.trackData)},onUnselect:function(){this.plugin.onUnselect()},onTrackDown:function(a,b){this.selectTrack(a);paella.editor.instance.bottomBar.toolbar.onToolChanged(this.plugin.getName(),this.plugin.getTrackName())},onResizerDown:function(a,c,b){if(b){this.resizeTrack=a;this.currentResizer=c;this.lastPos.x=b.clientX;this.lastPos.y=b.clientY}},onResizerUp:function(d,a){if(this.resizeTrack){var g=paella.player.videoContainer.duration(true);var i=$(this.container).width();var f=$(this.resizeTrack).position().left;var c=$(this.resizeTrack).width();f=f*100/i;c=c*100/i;var b=f*g/100;var h=(f+c)*g/100;var j=this.resizeTrack.trackInfo.plugin;var e=this.resizeTrack.trackInfo.trackData;j.onTrackChanged(e.id,b,h);paella.editor.pluginManager.onTrackChanged(j);paella.editor.instance.rightBar.updateCurrentTab();paella.editor.instance.bottomBar.timeline.rebuildTrack(j.getName());this.resizeTrack.trackInfo.trackData;$(this.resizeTrack).css({left:f+"%",width:c+"%"})}this.resizeTrack=null},onResizerMove:function(b){if(this.resizeTrack){var e={x:b.clientX-this.lastPos.x,y:b.clientY-this.lastPos.y};var d=paella.player.videoContainer.duration(true);var c=$(this.resizeTrack).position().left;var a=$(this.resizeTrack).width();if(this.currentResizer=="L"){c+=e.x;a-=e.x;$(this.resizeTrack).css({left:c+"px",width:a+"px"})}else{if(this.currentResizer=="R"){a+=e.x;$(this.resizeTrack).css({width:a+"px"})}else{if(this.currentResizer=="M"){c+=e.x;$(this.resizeTrack).css({left:c+"px"})}}}this.lastPos.x=b.clientX;this.lastPos.y=b.clientY}}});paella.editor.EmbedPlayer=Class.create(paella.AsyncLoaderCallback,{editar:null,initialize:function(){this.editor=paella.editor.instance},load:function(d,b){var c=this.editor.bottomBar.getHeight()+20;var a=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:c+"px",right:a+"px",left:"20px",top:"20px"});paella.player.mainContainer.className="paellaMainContainerEditorMode";new Timer(function(e){paella.player.controls.disable();paella.player.onresize();if(d){d()}},500)},restorePlayer:function(){$("body")[0].appendChild(paella.player.mainContainer);paella.player.controls.enable();paella.player.mainContainer.className="";$(paella.player.mainContainer).css({position:"",width:"",bottom:"",left:"",right:"",top:""});paella.player.onresize()},onresize:function(){var b=this.editor.bottomBar.getHeight()+20;var a=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:b+"px",right:a+"px",left:"20px",top:"20px"})}});paella.editor.Editor=Class.create({config:null,editorContainer:null,isLoaded:false,bottomBar:null,rightBar:null,embedPlayer:null,loader:null,initialize:function(){if(paella.player.accessControl.permissions.canWrite){var a=this;paella.editor.instance=this;paella.initDelegate.loadEditorConfig(function(b){a.config=b;a.loadEditor()})}},loadEditor:function(){paella.keyManager.enabled=false;var a=this;this.editorContainer=document.createElement("div");$("body")[0].appendChild(this.editorContainer);this.editorContainer.className="editorContainer";this.editorContainer.id="editorContainer";this.editorContainer.appendChild(paella.player.mainContainer);$("body")[0].style.backgroundImage="url(resources/images/editor_video_bkg.png)";this.loader=new paella.AsyncLoader();this.bottomBar=this.loader.addCallback(new paella.editor.BottomBar());this.rightBar=this.loader.addCallback(new paella.editor.RightBar());this.embedPlayer=this.loader.addCallback(new paella.editor.EmbedPlayer());this.loader.load(function(){a.onLoadSuccess()},function(){a.onLoadFail()})},onLoadSuccess:function(){this.isLoaded=true;var a=this;this.onresize();$(window).resize(function(b){a.onresize()});$(document).trigger(paella.events.play);new Timer(function(b){$(document).trigger(paella.events.pause)},100);paella.events.bind(paella.events.documentChanged,function(b,c){window.onbeforeunload=function(d){return paella.dictionary.translate("There are unsaved changes")}});paella.events.bind(paella.events.didSaveChanges,function(b,c){window.onbeforeunload=null})},onLoadFail:function(){},unloadEditor:function(){paella.keyManager.enabled=true;this.embedPlayer.restorePlayer();$("body")[0].removeChild(this.editorContainer);$("body")[0].style.backgroundImage="";this.editorContainer=null;this.isLoaded=false;$(document).trigger(paella.events.pause);$(document).trigger(paella.events.hideEditor)},onresize:function(){if(this.isLoaded){this.bottomBar.onresize();this.rightBar.onresize();this.embedPlayer.onresize()}}});paella.editor.ToolStatusPlugin=Class.create(paella.editor.RightBarPlugin,{currentTrack:null,currentTextField:null,trackItemContainer:null,selectedColor:"rgb(255, 255, 236)",initialize:function(){this.parent();if(paella.utils.language()=="es"){var a={Tool:"Herramienta","Selected tool":"Herramienta seleccionada","this track does not contain any item":"esta pista no contiene ningún elemento","Click on timeline outside any track to select current playback time.":"Haz clic en el fondo de la línea de tiempo para establecer el instante actual de reproducción","Quick help":"Ayuda rápida",item:"elemento",items:"elementos",from:"desde",to:"hasta"};paella.dictionary.addDictionary(a)}},getIndex:function(){return 10000},getName:function(){return"es.upv.paella.editor.toolStatusPlugin"},getTabName:function(){return paella.dictionary.translate("Tool")},getContent:function(){this.currentTextField=null;var d=document.createElement("div");if(this.currentTrack){var c=paella.pluginManager.getPlugin(this.currentTrack.getName());d.innerHTML="<h6>"+paella.dictionary.translate("Tool")+": "+paella.dictionary.translate(this.currentTrack.getTrackName())+"</h6>";var e=this.currentTrack.getTrackItems();var a=document.createElement("div");a.className="editorPluginToolStatus_trackItemList";this.trackItemContainer=a;c.buildToolTabContent(a);if(a.childNodes.length==0){for(var b=0;b<e.length;++b){this.addTrackData(a,e[b])}}d.appendChild(a)}else{d.innerHTML="<h6>"+paella.dictionary.translate("Tool")+": "+paella.dictionary.translate("Selection")+"</h6>"}this.addToolHelp(d);return d},addTrackData:function(b,a){var e=document.createElement("div");var f=document.createElement("div");var d=Math.round((a.e-a.s)*100)/100;f.innerHTML=paella.dictionary.translate("from")+" "+paella.utils.timeParse.secondsToTime(a.s)+" "+paella.dictionary.translate("to")+" "+paella.utils.timeParse.secondsToTime(a.e)+", "+d+" sec";e.appendChild(f);if(a.content){var c=paella.AntiXSS.htmlUnescape(a.content);this.addTrackContent(e,a.id,c,a.s,a.e)}b.appendChild(e)},addTrackContent:function(i,a,g,b,c){var d=null;var h=this;if(this.currentTrack.allowEditContent()){d=document.createElement("input");d.setAttribute("type","text");d.setAttribute("id","trackContentEditor_"+a);d.setAttribute("value",g);d.trackData={id:a,content:g,s:b,e:c};d.plugin=this.currentTrack;$(d).change(function(e){this.plugin.onTrackContentChanged(this.trackData.id,$(this).val());paella.editor.instance.bottomBar.timeline.rebuildTrack(this.plugin.getName())});$(d).click(function(e){h.onFocusChanged(this,this.plugin,this.trackData)});$(d).focus(function(e){h.onFocusChanged(this,this.plugin,this.trackData)});var j=-1;try{j=this.currentTrack.trackInfo.trackData.id}catch(f){}if(j==a){this.currentTextField=d;this.currentTextField.style.backgroundColor=this.selectedColor}}else{d=document.createElement("input");d.setAttribute("type","text");d.setAttribute("id",a);d.setAttribute("disabled","disabled");d.setAttribute("style","color:rgb(119, 119, 119)");d.setAttribute("value",g)}i.appendChild(d)},onFocusChanged:function(d,a,c){if(this.currentTextField){this.currentTextField.style.backgroundColor="#fff"}d.style.backgroundColor=this.selectedColor;paella.editor.instance.bottomBar.timeline.focusTrackListItem(a.getName(),c.id);this.currentTextField=d;var b=c.e;$(document).trigger(paella.events.seekToTime,{time:b})},onLoadFinished:function(){if(this.currentTextField){this.trackItemContainer.scrollTop=$(this.currentTextField).position().top}},addToolHelp:function(c){var b="";if(this.currentTrack){b=this.currentTrack.contextHelpString()}else{b=paella.dictionary.translate("Click on timeline outside any track to select current playback time.")}if(b!=""){var a=document.createElement("div");a.className="editorPluginToolStatusHelp";c.appendChild(a);a.innerHTML="<strong>"+paella.dictionary.translate("Quick help")+": </strong>"+b}},onTrackSelected:function(a){this.currentTrack=a}});new paella.editor.ToolStatusPlugin();paella.plugins.BreaksEditorPlugin=Class.create(paella.editor.MainTrackPlugin,{tracks:null,selectedTrackItem:null,checkEnabled:function(b){var a=this;this.tracks=[];paella.data.read("breaks",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.breaks&&d.breaks.length>0){a.tracks=d.breaks}b(true)})},setup:function(){if(paella.utils.language()=="es"){var a={Breaks:"Descansos",Break:"Descanso","Create a new break in the current position":"Añade un descanso en el instante actual","Delete selected break":"Borra el descanso seleccionado"};paella.dictionary.addDictionary(a)}},getTrackItems:function(){return this.tracks},getTools:function(){return[{name:"create",label:paella.dictionary.translate("Create"),hint:paella.dictionary.translate("Create a new break in the current position")},{name:"delete",label:paella.dictionary.translate("Delete"),hint:paella.dictionary.translate("Delete selected break")}]},onToolSelected:function(c){if(this.selectedTrackItem&&c=="delete"&&this.selectedTrackItem){paella.events.trigger(paella.events.documentChanged);this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);return true}else{if(c=="create"){paella.events.trigger(paella.events.documentChanged);var e=paella.player.videoContainer.currentTime();var a=e+30;var d=this.getTrackUniqueId();var b=paella.dictionary.translate("Break");this.tracks.push({id:d,s:e,e:a,content:b,name:b});return true}}},getTrackUniqueId:function(){var a=-1;if(this.tracks.length==0){return 1}for(var b=0;b<this.tracks.length;++b){if(a<=this.tracks[b].id){a=this.tracks[b].id+1}}return a},getName:function(){return"es.upv.paella.editor.trackBreaks"},getTrackName:function(){return paella.dictionary.translate("Breaks")},getColor:function(){return"rgb(219, 81, 81)"},getTextColor:function(){return"rgb(90,90,90)"},onTrackChanged:function(d,c,a){paella.events.trigger(paella.events.documentChanged);var b=this.getTrackItem(d);if(b){b.s=c;b.e=a;this.selectedTrackItem=b}},onTrackContentChanged:function(c,b){paella.events.trigger(paella.events.documentChanged);var a=this.getTrackItem(c);if(a){a.content=paella.AntiXSS.htmlEscape(b);a.name=paella.AntiXSS.htmlEscape(b)}},allowEditContent:function(){return true},getTrackItem:function(b){for(var a=0;a<this.tracks.length;++a){if(this.tracks[a].id==b){return this.tracks[a]}}},contextHelpString:function(){if(paella.utils.language()=="es"){return"Utiliza esta herramienta para crear, borrar y editar descansos. Para crear un descanso, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los descansos"}else{return"Use this tool to create, delete and edit breaks. To create a break, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the break text."}},onSave:function(b){var a={breaks:this.tracks};paella.data.write("breaks",{id:paella.initDelegate.getId()},a,function(d,c){paella.plugins.breaksPlayerPlugin.breaks=a.breaks;b(c)})}});paella.plugins.breaksEditorPlugin=new paella.plugins.BreaksEditorPlugin();paella.plugins.BreaksPlayerPlugin=Class.create(paella.EventDrivenPlugin,{breaks:null,lastEvent:0,visibleBreaks:null,getName:function(){return"es.upv.paella.BreaksPlayerPlugin"},checkEnabled:function(b){var a=this;this.breaks=[];this.visibleBreaks=[];paella.data.read("breaks",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.breaks&&d.breaks.length>0){a.breaks=d.breaks}b(true)})},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(a,b){this.checkBreaks(b)},checkBreaks:function(e){for(var d=0;d<this.breaks.length;++d){var b=this.breaks[d];if(b.s<e.currentTime&&b.e>e.currentTime){this.showBreaks(b)}else{if(b.s.toFixed(0)==e.currentTime.toFixed(0)){this.avoidBreak(b)}}}for(var c in this.visibleBreaks){if(typeof(b)=="object"){var b=this.visibleBreaks[c];if(b&&(b.s>=e.currentTime||b.e<=e.currentTime)){this.removeBreak(b)}}}},showBreaks:function(a){if(!this.visibleBreaks[a.s]){var b={left:100,top:350,width:1080,height:20};a.elem=paella.player.videoContainer.overlayContainer.addText(a.content,b);a.elem.className="textBreak";this.visibleBreaks[a.s]=a}},removeBreak:function(a){if(this.visibleBreaks[a.s]){var b=this.visibleBreaks[a.s].elem;paella.player.videoContainer.overlayContainer.removeElement(b);this.visibleBreaks[a.s]=null}},avoidBreak:function(a){var b=a.e;paella.events.trigger(paella.events.seekToTime,{time:b})}});paella.plugins.breaksPlayerPlugin=new paella.plugins.BreaksPlayerPlugin();paella.plugins.CaptionsEditorPlugin=Class.create(paella.editor.TrackPlugin,{tracks:null,selectedTrackItem:null,checkEnabled:function(b){var a=this;this.tracks=[];paella.data.read("captions",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.captions&&d.captions.length>0){a.tracks=d.captions}b(true)})},setup:function(){if(paella.utils.language()=="es"){var a={Captions:"Subtítulos",Caption:"Subtítulo","Create a new caption in the current position":"Añade un subtítulo en el instante actual","Delete selected caption":"Borra el subtítulo seleccionado"};paella.dictionary.addDictionary(a)}},getTrackItems:function(){return this.tracks},getTools:function(){return[{name:"create",label:paella.dictionary.translate("Create"),hint:paella.dictionary.translate("Create a new caption in the current position")},{name:"delete",label:paella.dictionary.translate("Delete"),hint:paella.dictionary.translate("Delete selected caption")}]},onToolSelected:function(c){if(this.selectedTrackItem&&c=="delete"&&this.selectedTrackItem){paella.events.trigger(paella.events.documentChanged);this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);return true}else{if(c=="create"){paella.events.trigger(paella.events.documentChanged);var e=paella.player.videoContainer.currentTime();var a=e+30;var d=this.getTrackUniqueId();var b=paella.dictionary.translate("Caption");this.tracks.push({id:d,s:e,e:a,content:b,name:b});return true}}},getTrackUniqueId:function(){var a=-1;if(this.tracks.length==0){return 1}for(var b=0;b<this.tracks.length;++b){if(a<=this.tracks[b].id){a=this.tracks[b].id+1}}return a},getName:function(){return"es.upv.paella.editor.trackCaptions"},getTrackName:function(){return paella.dictionary.translate("Captions")},getColor:function(){return"rgb(159, 166, 88)"},getTextColor:function(){return"rgb(90,90,90)"},onTrackChanged:function(d,c,a){paella.events.trigger(paella.events.documentChanged);var b=this.getTrackItem(d);if(b){b.s=c;b.e=a;this.selectedTrackItem=b}},onTrackContentChanged:function(c,b){paella.events.trigger(paella.events.documentChanged);var a=this.getTrackItem(c);if(a){a.content=paella.AntiXSS.htmlEscape(b);a.name=paella.AntiXSS.htmlEscape(b)}},allowEditContent:function(){return true},getTrackItem:function(b){for(var a=0;a<this.tracks.length;++a){if(this.tracks[a].id==b){return this.tracks[a]}}},contextHelpString:function(){if(paella.utils.language()=="es"){return"Utiliza esta herramienta para crear, borrar y editar subtítulos. Para crear un subtítulo, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los subtítulos"}else{return"Use this tool to create, delete and edit video captions. To create a caption, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the caption text."}},onSave:function(f){var e={captions:[]};for(var d=0;d<this.tracks.length;++d){var a=this.tracks[d];var b={};for(var c in a){if(c!="elem"){b[c]=a[c]}}e.captions.push(b)}paella.data.write("captions",{id:paella.initDelegate.getId()},e,function(h,g){paella.plugins.captionsPlayerlugin.captions=e.captions;f(g)});if(e.captions.length>=1){paella.plugins.activeCaptionsPlugin.setButtonEnabled(true)}else{paella.plugins.activeCaptionsPlugin.setButtonEnabled(false)}}});paella.plugins.captionsEditorPlugin=new paella.plugins.CaptionsEditorPlugin();paella.plugins.CaptionsPlayerPlugin=Class.create(paella.EventDrivenPlugin,{captions:null,lastEvent:0,visibleCaptions:[],captionsEnabled:null,root:null,element:null,counter:0,getName:function(){return"es.upv.paella.CaptionsPlayerPlugin"},checkEnabled:function(b){var a=this;this.captions=[];this.visibleCaptions=[];paella.data.read("captions",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.captions&&d.captions.length>0){a.captions=d.captions}b(true)})},setup:function(){var b=paella.player.videoContainer.overlayContainer;var a={left:100,top:620,width:1080,height:20};this.root=document.createElement("div");this.root.className="videoLoadTestOverlay";this.element=document.createElement("div");this.element.className="textCaption";this.root.appendChild(this.element)},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(a,b){this.checkCaptions(b)},checkCaptions:function(e){for(var d=0;d<this.captions.length;++d){var b=this.captions[d];if(this.captionsEnabled&&b.s<e.currentTime&&b.e>e.currentTime){this.showCaption(b)}}for(var c in this.visibleCaptions){if(typeof(b)=="object"){var b=this.visibleCaptions[c];if(b&&(b.s>=e.currentTime||b.e<=e.currentTime||!this.captionsEnabled)){this.removeCaption(b)}}}if(this.counter<=0){this.element.innerHTML="";this.element.className="textCaption disabled"}},showCaption:function(a){this.element.className="textCaption";this.element.innerHTML=a.content;if(!this.visibleCaptions[a.s]){var c=paella.player.videoContainer.overlayContainer;var b={left:100,top:620,width:1080,height:20};c.addElement(this.root,b);this.counter++;this.visibleCaptions[a.s]=a}},removeCaption:function(a){if(this.visibleCaptions[a.s]){this.counter--;this.visibleCaptions[a.s]=null}}});paella.plugins.captionsPlayerlugin=new paella.plugins.CaptionsPlayerPlugin();paella.plugins.ActiveCaptionsPlugin=Class.create(paella.ButtonPlugin,{button:null,buttonEnabled:true,getAlignment:function(){return"right"},getSubclass:function(){return"showCaptionsPluginButton"},getIndex:function(){return 580},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.activeCaptionsPlugin"},checkEnabled:function(b){var a=this;paella.data.read("captions",{id:paella.initDelegate.getId()},function(d,c){if(!(d&&typeof(d)=="object"&&d.captions&&d.captions.length>0)){a.button.className=a.getButtonItemClass(false,false);a.buttonEnabled=false}b(true)})},getDefaultToolTip:function(){return paella.dictionary.translate("Show captions")},setup:function(){if(this.buttonEnabled){this.showButton()}else{this.hideButton()}},action:function(a){this.button=a;if(this.activeCaptions){a.className=this.getButtonItemClass(false,true);paella.plugins.captionsPlayerlugin.captionsEnabled=false;this.activeCaptions=false}else{a.className=this.getButtonItemClass(true,true);paella.plugins.captionsPlayerlugin.captionsEnabled=true;this.activeCaptions=true}},setButtonEnabled:function(a){var b=this.button.className.split(" ");this.activeCaptions=((a)&&(b[3]=="selected"));this.button.className=this.getButtonItemClass(b[3]=="selected",a);if(a){this.showButton()}else{this.hideButton()}paella.plugins.captionsPlayerlugin.captionsEnabled=((a)&&(b[3]=="selected"))},getButtonItemClass:function(b,a){return"buttonPlugin "+this.getAlignment()+" "+this.getSubclass()+((b)?" selected":"")+((a)?"":" disabled")}});paella.plugins.activeCaptionsPlugin=new paella.plugins.ActiveCaptionsPlugin();paella.plugins.CommentsPlugin=Class.create(paella.TabBarPlugin,{divRoot:null,divPublishComment:null,divComments:null,publishCommentTextArea:null,publishCommentButtons:null,canPublishAComment:false,comments:[],commentsTree:[],domElement:null,getSubclass:function(){return"showCommentsTabBar"},getName:function(){return"es.upv.paella.commentsPlugin"},getTabName:function(){return paella.dictionary.translate("Comments")},checkEnabled:function(a){a(paella.extended)},getIndex:function(){return 40},getDefaultToolTip:function(){return paella.dictionary.translate("Comments")},action:function(a){this.loadContent()},buildContent:function(a){this.domElement=a;this.canPublishAComment=paella.initDelegate.initParams.accessControl.permissions.canWrite;this.loadContent()},loadContent:function(){this.divRoot=this.domElement;this.divRoot.innerHTML="";this.divPublishComment=document.createElement("div");this.divPublishComment.className="CommentPlugin_Publish";this.divPublishComment.id="CommentPlugin_Publish";this.divComments=document.createElement("div");this.divComments.className="CommentPlugin_Comments";this.divComments.id="CommentPlugin_Comments";if(this.canPublishAComment){this.divRoot.appendChild(this.divPublishComment);this.createPublishComment()}this.divRoot.appendChild(this.divComments);this.reloadComments()},createPublishComment:function(){var b=this;var f=this.divPublishComment.id+"_entry";var d;d=document.createElement("div");d.id=f;d.className="comments_entry";var c;c=document.createElement("img");c.className="comments_entry_silhouette";c.style.width="48px";c.src=paella.initDelegate.initParams.accessControl.userData.avatar;c.id=f+"_silhouette";d.appendChild(c);var a;a=document.createElement("div");a.className="comments_entry_container";a.id=f+"_textarea_container";d.appendChild(a);this.publishCommentTextArea=document.createElement("textarea");this.publishCommentTextArea.id=f+"_textarea";this.publishCommentTextArea.onclick=function(){paella.keyManager.enabled=false};this.publishCommentTextArea.onblur=function(){paella.keyManager.enabled=true};a.appendChild(this.publishCommentTextArea);this.publishCommentButtons=document.createElement("div");this.publishCommentButtons.id=f+"_buttons_area";a.appendChild(this.publishCommentButtons);var e;e=document.createElement("button");e.id=f+"_btnAddComment";e.className="publish";e.onclick=function(){var g=b.publishCommentTextArea.value;if(g.replace(/\s/g,"")!=""){b.addComment()}};e.innerHTML=paella.dictionary.translate("Publish");this.publishCommentButtons.appendChild(e);a.commentsTextArea=this.publishCommentTextArea;a.commentsBtnAddComment=e;a.commentsBtnAddCommentToInstant=this.btnAddCommentToInstant;this.divPublishComment.appendChild(d)},addComment:function(){var a=this;var d=paella.AntiXSS.htmlEscape(a.publishCommentTextArea.value);var b=new Date();this.comments.push({id:paella.utils.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"normal",value:d,created:b});var c={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},c,function(f,e){if(e){a.loadContent()}})},addReply:function(c,f){var a=this;var g=document.getElementById(f);var e=paella.AntiXSS.htmlEscape(g.value);var b=new Date();paella.keyManager.enabled=true;this.comments.push({id:paella.utils.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"reply",parent:c,value:e,created:b});var d={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},d,function(i,h){if(h){a.reloadComments()}})},reloadComments:function(){var a=this;a.commentsTree=[];a.comments=[];this.divComments.innerHTML="";paella.data.read("comments",{id:paella.initDelegate.getId()},function(g,c){if(g&&typeof(g)=="object"&&g.allComments&&g.allComments.length>0){a.comments=g.allComments;var b={};for(var f=0;f<g.allComments.length;++f){var e=g.allComments[f].value;if(g.allComments[f].mode!=="reply"){var h={};h.id=g.allComments[f].id;h.userName=g.allComments[f].userName;h.mode=g.allComments[f].mode;h.value=e;h.created=g.allComments[f].created;h.replies=[];a.commentsTree.push(h);b[h.id]=a.commentsTree.length-1}}for(var f=0;f<g.allComments.length;++f){var e=g.allComments[f].value;if(g.allComments[f].mode==="reply"){var h={};h.id=g.allComments[f].id;h.userName=g.allComments[f].userName;h.mode=g.allComments[f].mode;h.value=e;h.created=g.allComments[f].created;var d=b[g.allComments[f].parent];a.commentsTree[d]["replies"].push(h)}}a.displayComments()}})},displayComments:function(){var a=this;for(var b=0;b<a.commentsTree.length;++b){var d=a.commentsTree[b];var c=a.createACommentEntry(d);a.divComments.appendChild(c)}},createACommentEntry:function(h){var p=this;var d=this.divPublishComment.id+"_entry"+h.id;var c;var q;q=document.createElement("div");q.id=d;q.className="comments_entry";var k;k=document.createElement("img");k.className="comments_entry_silhouette";k.id=d+"_silhouette";q.appendChild(k);var l;l=document.createElement("div");l.className="comments_entry_container";l.id=d+"_comment_container";q.appendChild(l);var o;o=document.createElement("div");o.id=d+"_comment_metadata";l.appendChild(o);var m="";if(h.created){var b=new Date();var n=paella.utils.timeParse.matterhornTextDateToDate(h.created);m=paella.utils.timeParse.secondsToText((b.getTime()-n.getTime())/1000)}var g;g=document.createElement("div");g.id=d+"_comment_value";g.className="comments_entry_comment";l.appendChild(g);g.innerHTML=h.value;var r=document.createElement("div");r.id=d+"_comment_reply";l.appendChild(r);paella.data.read("userInfo",{username:h.userName},function(s,i){if(s){k.src=s.avatar;var e="<span class='comments_entry_username'>"+s.name+" "+s.lastname+"</span>";e+="<span class='comments_entry_datepublish'>"+m+"</span>";o.innerHTML=e}});if(this.canPublishAComment==true){var a=document.createElement("div");a.className="reply_button";a.innerHTML=paella.dictionary.translate("Reply");a.id=d+"_comment_reply_button";a.onclick=function(){var i=p.createAReplyEntry(h.id);this.style.display="none";this.parentElement.parentElement.appendChild(i)};r.appendChild(a)}for(var f=0;f<h.replies.length;++f){var j=p.createACommentReplyEntry(h.id,h.replies[f]);l.appendChild(j)}return q},createACommentReplyEntry:function(k,d){var j=this;var b=this.divPublishComment.id+"_entry_"+k+"_reply_"+d.id;var l;l=document.createElement("div");l.id=b;l.className="comments_entry";var e;e=document.createElement("img");e.className="comments_entry_silhouette";e.id=b+"_silhouette";l.appendChild(e);var f;f=document.createElement("div");f.className="comments_entry_container";f.id=b+"_comment_container";l.appendChild(f);var i;i=document.createElement("div");i.id=b+"_comment_metadata";f.appendChild(i);var g="";if(d.created){var a=new Date();var h=paella.utils.timeParse.matterhornTextDateToDate(d.created);g=paella.utils.timeParse.secondsToText((a.getTime()-h.getTime())/1000)}var c;c=document.createElement("div");c.id=b+"_comment_value";c.className="comments_entry_comment";f.appendChild(c);c.innerHTML=d.value;paella.data.read("userInfo",{username:d.userName},function(o,n){if(o){e.src=o.avatar;var m="<span class='comments_entry_username'>"+o.name+" "+o.lastname+"</span>";m+="<span class='comments_entry_datepublish'>"+g+"</span>";i.innerHTML=m}});return l},createAReplyEntry:function(f){var b=this;var h=this.divPublishComment.id+"_entry_"+f+"_reply";var d;d=document.createElement("div");d.id=h+"_entry";d.className="comments_entry";var c;c=document.createElement("img");c.className="comments_entry_silhouette";c.style.width="48px";c.id=h+"_silhouette";c.src=paella.initDelegate.initParams.accessControl.userData.avatar;d.appendChild(c);var a;a=document.createElement("div");a.className="comments_entry_container comments_reply_container";a.id=h+"_reply_container";d.appendChild(a);var g;g=document.createElement("textArea");g.onclick=function(){paella.keyManager.enabled=false};g.draggable=false;g.id=h+"_textarea";a.appendChild(g);this.publishCommentButtons=document.createElement("div");this.publishCommentButtons.id=h+"_buttons_area";a.appendChild(this.publishCommentButtons);var e;e=document.createElement("button");e.id=h+"_btnAddComment";e.className="publish";e.onclick=function(){var i=g.value;if(i.replace(/\s/g,"")!=""){b.addReply(f,g.id)}};e.innerHTML=paella.dictionary.translate("Reply");this.publishCommentButtons.appendChild(e);return d}});paella.plugins.commentsPlugin=new paella.plugins.CommentsPlugin();paella.plugins.ConsolidateEditorPlugin=Class.create(paella.editor.TrackPlugin,{tracks:null,selectedTrackItem:null,checkEnabled:function(b){var a=this;this.tracks=[];paella.data.read("consolidate",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.consolidate&&d.consolidate.length>0){a.tracks=d.consolidate}b(true)})},setup:function(){if(paella.utils.language()=="es"){var a={Create:"Crear",Delete:"Borrar",};paella.dictionary.addDictionary(a)}},getTrackItems:function(){return this.tracks},getTools:function(){return[{name:"create",label:paella.dictionary.translate("Create"),hint:paella.dictionary.translate("Create a new XX in the current position")},{name:"delete",label:paella.dictionary.translate("Delete"),hint:paella.dictionary.translate("Delete selected XX")}]},onToolSelected:function(c){if(this.selectedTrackItem&&c=="delete"&&this.selectedTrackItem){paella.events.trigger(paella.events.documentChanged);this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);return true}else{if(c=="create"){paella.events.trigger(paella.events.documentChanged);var e=paella.player.videoContainer.currentTime();var a=e+30;var d=this.getTrackUniqueId();var b=paella.dictionary.translate("Consolidate");this.tracks.push({id:d,s:e,e:a,content:b,name:b});return true}}},getTrackUniqueId:function(){var a=-1;if(this.tracks.length==0){return 1}for(var b=0;b<this.tracks.length;++b){if(a<=this.tracks[b].id){a=this.tracks[b].id+1}}return a},getName:function(){return"es.upv.paella.editor.TrackConsolidate"},getTrackName:function(){return paella.dictionary.translate("Consolidate")},getColor:function(){return"rgb(212, 212, 224)"},getTextColor:function(){return"rgb(90,90,90)"},onTrackChanged:function(e,d,a){paella.events.trigger(paella.events.documentChanged);var c=this.getTrackItem(e);if(c){if(this.tracks.length!=0){for(var b=0;b<this.tracks.length;++b){if(e!=this.tracks[b].id){if(a>this.tracks[b].s&&d<this.tracks[b].e){if(d<this.tracks[b].s){a=this.tracks[b].s}if(a>this.tracks[b].e){d=this.tracks[b].e}if(d>this.tracks[b].s&&a<this.tracks[b].e){a=0;d=0}}}}}c.s=d;c.e=a;c.d=a-d;this.selectedTrackItem=c}},onTrackContentChanged:function(c,b){paella.events.trigger(paella.events.documentChanged);var a=this.getTrackItem(c);if(a){a.content=b;a.name=b}},allowEditContent:function(){return true},getTrackItem:function(b){for(var a=0;a<this.tracks.length;++a){if(this.tracks[a].id==b){return this.tracks[a]}}},contextHelpString:function(){if(paella.utils.language()=="es"){return"Utiliza esta herramienta para crear, borrar y editar xxx. Para crear una xxx, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de las anotaciones"}else{return"Use this tool to create, delete and edit video consolidate. To create an xxx, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the xxx text."}},buildToolTabContent:function(a){},onSave:function(b){var a={consolidate:this.tracks};paella.data.write("consolidate",{id:paella.initDelegate.getId()},a,function(d,c){b(c)})}});paella.plugins.consolidateEditorPlugin=new paella.plugins.ConsolidateEditorPlugin();paella.editor.ConsolidatePlugin=Class.create(paella.editor.RightBarPlugin,{currentTrack:null,currentTextField:null,trackItemContainer:null,selectedColor:"rgb(255, 255, 236)",getIndex:function(){return 10001},getName:function(){return"es.upv.paella.editor.consolidatePlugin"},getTabName:function(){return"Consolidate"},getContent:function(){this.currentTextField=null;var c=document.createElement("div");if(this.currentTrack&&this.currentTrack.getTrackName()=="Consolidate"){c.innerHTML="<h6>"+paella.dictionary.translate("Tool")+": "+paella.dictionary.translate(this.currentTrack.getTrackName())+"</h6>";var d=this.currentTrack.getTrackItems();var a=document.createElement("div");a.className="editorPluginConsolidate_trackItemList";this.trackItemContainer=a;for(var b=0;b<d.length;++b){this.addTrackData(a,d[b])}c.appendChild(a);this.addToolHelp(c)}else{c.innerHTML+="<p> No hay opciones que mostrar para esta herramienta.</p>"}return c},addTrackData:function(b,a){var d=document.createElement("div");var e=document.createElement("div");var c=Math.round((a.e-a.s)*100)/100;e.innerHTML=paella.dictionary.translate("from")+" "+paella.utils.timeParse.secondsToTime(a.s)+" "+paella.dictionary.translate("to")+" "+paella.utils.timeParse.secondsToTime(a.e)+", "+c+" sec";d.appendChild(e);if(a.content){this.addTrackContent(d,a.id,a.content,a.s,a.e)}b.appendChild(d)},addTrackContent:function(d,h,e,g,c){var a=null;var b=this;if(this.currentTrack.allowEditContent()){a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id","trackContentEditor_"+h);a.setAttribute("value",e);a.trackData={id:h,content:e,s:g,e:c};a.plugin=this.currentTrack;$(a).change(function(i){this.plugin.onTrackContentChanged(this.trackData.id,$(this).val());paella.editor.instance.bottomBar.timeline.rebuildTrack(this.plugin.getName())});$(a).click(function(i){b.onFocusChanged(this,this.plugin,this.trackData)});$(a).focus(function(i){b.onFocusChanged(this,this.plugin,this.trackData)});var f=paella.editor.instance.bottomBar.timeline.currentTrackList.currentTrack.trackInfo.trackData.id;if(f==h){this.currentTextField=a;this.currentTextField.style.backgroundColor=this.selectedColor}}else{a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id",h);a.setAttribute("disabled","disabled");a.setAttribute("style","color:rgb(119, 119, 119)");a.setAttribute("value",e)}d.appendChild(a)},onFocusChanged:function(d,a,c){if(this.currentTextField){this.currentTextField.style.backgroundColor="#fff"}d.style.backgroundColor=this.selectedColor;paella.editor.instance.bottomBar.timeline.focusTrackListItem(a.getName(),c.id);this.currentTextField=d;var b=c.e;$(document).trigger(paella.events.seekToTime,{time:b})},onLoadFinished:function(){if(this.currentTextField){this.trackItemContainer.scrollTop=$(this.currentTextField).position().top}},addToolHelp:function(c){var b="";if(this.currentTrack){b=this.currentTrack.contextHelpString()}else{b="Texto de ayuda PROVISIONAL"}if(b!=""){var a=document.createElement("div");a.className="editorPluginConsolidateHelp";c.appendChild(a);a.innerHTML="<strong>"+paella.dictionary.translate("Quick help")+": </strong>"+b}},onTrackSelected:function(a){this.currentTrack=a},addElement:function(){var a=document.createElement("div")}});new paella.editor.ConsolidatePlugin();paella.plugins.DescriptionPlugin=Class.create(paella.TabBarPlugin,{getSubclass:function(){return"showDescriptionTabBar"},getName:function(){return"es.upv.paella.descriptionPlugin"},getTabName:function(){return"Descripción"},domElement:null,buildContent:function(a){this.domElement=a;this.loadContent()},action:function(a){this.loadContent()},loadContent:function(){var a=this.domElement;a.innerHTML="Loading...";new paella.Timer(function(b){a.innerHTML="Loading done"},2000)}});paella.plugins.descriptionPlugin=new paella.plugins.DescriptionPlugin();paella.plugins.ExtendedProfilesPlugin=Class.create(paella.ButtonPlugin,{buttonItems:null,extendedModes:null,getAlignment:function(){return"right"},getSubclass:function(){return"showExtendedProfilesButton"},getIndex:function(){return 550},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.extendedProfilesPlugin"},getDefaultToolTip:function(){return paella.dictionary.translate("Change page layout")},checkEnabled:function(a){a(paella.extended)},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buttons:[],selected_button:null,setup:function(){var a=this;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40};$(this.button).keyup(function(b){if(a.isPopUpOpen()){if(b.keyCode==Keys.Up){if(a.selected_button>0){if(a.selected_button<a.buttons.length){a.buttons[a.selected_button].className="extendedProfilesItemButton "+a.buttons[a.selected_button].data.profileData}a.selected_button--;a.buttons[a.selected_button].className=a.buttons[a.selected_button].className+" selected"}}else{if(b.keyCode==Keys.Down){if(a.selected_button<a.buttons.length-1){if(a.selected_button>=0){a.buttons[a.selected_button].className="extendedProfilesItemButton "+a.buttons[a.selected_button].data.profileData}a.selected_button++;a.buttons[a.selected_button].className=a.buttons[a.selected_button].className+" selected"}}else{if(b.keyCode==Keys.Return){a.onItemClick(a.buttons[a.selected_button],a.buttons[a.selected_button].data.profile,a.buttons[a.selected_button].data.profileData)}}}}})},buildContent:function(e){var a=this;this.buttonItems={};extendedModes=["fullScr","full","big","small"];for(var d in extendedModes){var c=extendedModes[d];var b=a.getProfileItemButton(d,c);a.buttonItems[d]=b;e.appendChild(b);this.buttons.push(b)}this.selected_button=a.buttons.length},getProfileItemButton:function(a,c){var b=document.createElement("div");b.className="extendedProfilesItemButton "+c;b.id=a+"_button";b.data={profile:a,profileData:c,plugin:this};$(b).click(function(d){this.data.plugin.onItemClick(b,this.data.profile,this.data.profileData)});return b},onItemClick:function(a,b,c){if(c=="fullScr"){this.switchFullScreen(b,c)}else{if(this.isFullscreen()){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.cancelFullScreen){document.cancelFullScreen()}}}this.buttonItems[0].className=this.getButtonItemClass("fullScr",false)}this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className=this.getButtonItemClass(paella.extended.getProfile(),false);this.buttonItems[b].className=this.getButtonItemClass(c,true);paella.extended.setProfile(a.data.profileData)}paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()})},getButtonItemClass:function(b,a){return"extendedProfilesItemButton "+b+((a)?" selected":"")},switchFullScreen:function(d,e){var b=this;var a=document.getElementById(paella.player.mainContainer.id);if(this.isFullscreen()){this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className=this.getButtonItemClass(paella.extended.getProfile(),true);if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();this.buttonItems[d].className=this.getButtonItemClass(e,false)}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen();this.buttonItems[d].className=this.getButtonItemClass(e,false)}else{if(document.cancelFullScreen){document.cancelFullScreen();this.buttonItems[d].className=this.getButtonItemClass(e,false)}}}}else{this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className=this.getButtonItemClass(paella.extended.getProfile(),false);if(a.webkitRequestFullScreen){a.webkitRequestFullScreen();this.buttonItems[d].className=this.getButtonItemClass(e,true)}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen();this.buttonItems[d].className=this.getButtonItemClass(e,true)}else{if(a.requestFullScreen()){a.requestFullScreen();this.buttonItems[d].className=this.getButtonItemClass(e,true)}else{alert("Your browser does not support fullscreen mode")}}}var c=function(){var f=b.isFullscreen();console.log("f"+(f?"yes":"no"));if(f){var f=document.getElementById(paella.player.mainContainer.id);f.style.width="100%";f.style.height="100%"}else{var f=document.getElementById(paella.player.mainContainer.id);f.style.width="";f.style.height=""}};document.addEventListener("fullscreenchange",c,false);document.addEventListener("webkitfullscreenchange",c,false);document.addEventListener("mozfullscreenchange",c,false)}},isFullscreen:function(){if(document.webkitIsFullScreen!=undefined){return document.webkitIsFullScreen}else{if(document.mozFullScreen!=undefined){return document.mozFullScreen}}return false}});paella.plugins.extendedProfilesPlugin=new paella.plugins.ExtendedProfilesPlugin();paella.plugins.FootPrintsPlugin=Class.create(paella.ButtonPlugin,{INTERVAL_LENGTH:5,inPosition:0,outPosition:0,canvas:null,footPrintsTimer:null,footPrintsData:{},getAlignment:function(){return"right"},getSubclass:function(){return"footPrints"},getIndex:function(){return 590},getDefaultToolTip:function(){return paella.dictionary.translate("Show statistics")},getMinWindowSize:function(){return 700},getName:function(){return"es.upv.paella.FootPrintsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},setup:function(){var a=this;paella.events.bind(paella.events.timeUpdate,function(b){a.onTimeUpdate()});switch(this.config.skin){case"custom":this.fillStyle=this.config.fillStyle;this.strokeStyle=this.config.strokeStyle;break;case"dark":this.fillStyle="#727272";this.strokeStyle="#424242";break;case"light":this.fillStyle="#d8d8d8";this.strokeStyle="#ffffff";break;default:this.fillStyle="#d8d8d8";this.strokeStyle="#ffffff";break}},checkEnabled:function(a){a(true)},buildContent:function(b){var a=document.createElement("div");a.className="footPrintsContainer";this.canvas=document.createElement("canvas");this.canvas.id="footPrintsCanvas";this.canvas.className="footPrintsCanvas";a.appendChild(this.canvas);b.appendChild(a)},onTimeUpdate:function(){var a=Math.round(paella.player.videoContainer.currentTime()+paella.player.videoContainer.trimStart());if(this.inPosition<=a&&a<=this.inPosition+this.INTERVAL_LENGTH){this.outPosition=a;if(this.inPosition+this.INTERVAL_LENGTH===this.outPosition){this.trackFootPrint(this.inPosition,this.outPosition);this.inPosition=this.outPosition}}else{this.trackFootPrint(this.inPosition,this.outPosition);this.inPosition=a;this.outPosition=a}},trackFootPrint:function(a,b){var c={"in":a,out:b};paella.data.write("footprints",{id:paella.initDelegate.getId()},c)},willShowContent:function(){var a=this;this.loadFootprints();this.footPrintsTimer=new paella.utils.Timer(function(b){a.loadFootprints()},5000);this.footPrintsTimer.repeat=true},didHideContent:function(){if(this.footPrintsTimer!=null){this.footPrintsTimer.cancel();this.footPrintsTimer=null}},loadFootprints:function(){var a=this;paella.data.read("footprints",{id:paella.initDelegate.getId()},function(e,d){var l={};var b=Math.floor(paella.player.videoContainer.duration());var k=Math.floor(paella.player.videoContainer.trimStart());var g=-1;var h=0;for(var f=0;f<e.length;f++){position=e[f].position-k;if(position<b){views=e[f].views;if(position-1!=g){for(var c=g+1;c<position;c++){l[c]=h}}l[position]=views;g=position;h=views}}a.drawFootPrints(l)})},drawFootPrints:function(d){if(this.canvas){var e=Object.keys(d).length;var a=this.canvas.getContext("2d");var c=0;for(var b=0;b<e;++b){if(d[b]>c){c=d[b]}}this.canvas.setAttribute("width",e);this.canvas.setAttribute("height",c);a.clearRect(0,0,this.canvas.width,this.canvas.height);a.fillStyle=this.fillStyle;a.strokeStyle=this.strokeStyle;a.lineWidth=2;a.webkitImageSmoothingEnabled=false;a.mozImageSmoothingEnabled=false;for(var b=0;b<e-1;++b){a.beginPath();a.moveTo(b,c);a.lineTo(b,c-d[b]);a.lineTo(b+1,c-d[b+1]);a.lineTo(b+1,c);a.closePath();a.fill();a.beginPath();a.moveTo(b,c-d[b]);a.lineTo(b+1,c-d[b+1]);a.closePath();a.stroke()}}}});paella.plugins.footPrintsPlugin=new paella.plugins.FootPrintsPlugin();paella.plugins.FrameControlPlugin=Class.create(paella.ButtonPlugin,{frames:null,highResFrames:null,currentFrame:null,navButtons:null,buttons:[],contx:null,getAlignment:function(){return"right"},getSubclass:function(){return"frameControl"},getIndex:function(){return 510},getMinWindowSize:function(){return 200},getName:function(){return"es.upv.paella.FrameControlPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},getDefaultToolTip:function(){return paella.dictionary.translate("Navigate by slides")},checkEnabled:function(a){a(paella.initDelegate.initParams.videoLoader.frameList!=null)},setup:function(){var a=this;var b;var f=1;var d=0;var e=-1;var c;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40};$(this.button).keyup(function(i){var g=Math.floor(a.contx.offsetWidth/100);var h=a.buttons.length%g;var j=Math.floor(a.buttons.length/g);if(a.isPopUpOpen()){if(i.keyCode==Keys.Left){if(e>0){a.buttons[e].className=b;e--;if(f>j){d=g-h}c=((g)*(f-1))-1-d;if(e==c&&e!=0){a.navButtons.left.scrollContainer.scrollLeft-=g*105;--f}if(this.hiResFrame){a.removeHiResFrame()}a.buttons[e].frameControl.onMouseOver(null,a.buttons[e].frameData);b=a.buttons[e].className;a.buttons[e].className="frameControlItem selected"}}else{if(i.keyCode==Keys.Right){if(e<a.buttons.length-1){if(e>=0){a.buttons[e].className=b}e++;if(f==1){d=0}c=(g)*f-d;if(e==c){a.navButtons.left.scrollContainer.scrollLeft+=g*105;++f}if(this.hiResFrame){a.removeHiResFrame()}a.buttons[e].frameControl.onMouseOver(null,a.buttons[e].frameData);b=a.buttons[e].className;a.buttons[e].className="frameControlItem selected"}}else{if(i.keyCode==Keys.Return){a.buttons[e].frameControl.onClick(null,a.buttons[e].frameData);b="frameControlItem current"}else{if(i.keyCode==Keys.Esc){a.removeHiResFrame()}}}}}})},buildContent:function(e){var j=this;this.frames=[];var a=document.createElement("div");a.className="frameControlContainer";j.contx=a;var h=document.createElement("div");h.className="frameControlContent";this.navButtons={left:document.createElement("div"),right:document.createElement("div")};this.navButtons.left.className="frameControl navButton left";this.navButtons.right.className="frameControl navButton right";var c=this.getFrame(null);e.appendChild(this.navButtons.left);e.appendChild(a);a.appendChild(h);e.appendChild(this.navButtons.right);this.navButtons.left.scrollContainer=a;$(this.navButtons.left).click(function(l){this.scrollContainer.scrollLeft-=100});this.navButtons.right.scrollContainer=a;$(this.navButtons.right).click(function(l){this.scrollContainer.scrollLeft+=100});h.appendChild(c);var g=$(c).outerWidth(true);h.innerHTML="";var i=paella.initDelegate.initParams.videoLoader.frameList;if(i){var f=0;for(var k in i){var d=this.getFrame(i[k]);h.appendChild(d,"frameContrlItem_"+f);this.frames.push(d);++f}}$(h).css({width:(f*g)+"px"});var b=this;paella.events.bind(paella.events.setTrim,function(l,m){b.checkVisibility(m.trimEnabled,m.trimStart,m.trimEnd)});paella.events.bind(paella.events.timeupdate,function(l,m){b.onTimeUpdate(m.currentTime)})},showHiResFrame:function(b){var e=document.createElement("div");var c=document.createElement("div");var a=document.createElement("img");a.className="frameHiRes";a.setAttribute("src",b);a.setAttribute("style","width: 100%;");$(c).append(a);$(e).append(c);e.setAttribute("style","display: table;");c.setAttribute("style","display: table-cell; vertical-align:middle;");overlayContainer=paella.player.videoContainer.overlayContainer;var d=paella.initDelegate.initParams.videoLoader.streams;if(d.length==1){overlayContainer.addElement(e,overlayContainer.getMasterRect())}else{if(d.length>=2){overlayContainer.addElement(e,overlayContainer.getSlaveRect())}}overlayContainer.enableBackgroundMode();this.hiResFrame=e},removeHiResFrame:function(){overlayContainer=paella.player.videoContainer.overlayContainer;overlayContainer.removeElement(this.hiResFrame);overlayContainer.disableBackgroundMode()},checkVisibility:function(a,e,f){if(!a){for(var c=0;c<this.frames.length;++c){$(this.frames[c]).show()}}else{for(var c=0;c<this.frames.length;++c){var b=this.frames[c];var d=b.frameData;if(d.time<e){if(this.frames.length>c+1&&this.frames[c+1].frameData.time>e){$(b).show()}else{$(b).hide()}}else{if(d.time>f){$(b).hide()}else{$(b).show()}}}}},getFrame:function(b,d){var c=document.createElement("div");c.className="frameControlItem";if(d){c.id=d}if(b){this.buttons.push(c);c.frameData=b;c.frameControl=this;image=b.thumb?b.thumb:b.url;var a=paella.utils.timeParse.secondsToTime(b.time);c.innerHTML='<img src="'+image+'" alt="" class="frameControlImage" title="'+a+'" aria-label="'+a+'"></img>';$(c).mouseover(function(e){this.frameControl.onMouseOver(e,this.frameData)});$(c).mouseout(function(e){this.frameControl.onMouseOut(e,this.frameData)});$(c).click(function(e){this.frameControl.onClick(e,this.frameData)})}return c},onMouseOver:function(b,a){var e=paella.initDelegate.initParams.videoLoader.frameList;var d=e[a.time];if(d){var c=d.url;this.showHiResFrame(c)}},onMouseOut:function(b,a){this.removeHiResFrame()},onClick:function(b,a){paella.events.trigger(paella.events.seekToTime,{time:a.time+1})},onTimeUpdate:function(b){var c=null;for(var a=0;a<this.frames.length;++a){if(this.frames[a].frameData.time<=b){c=this.frames[a]}else{break}}if(this.currentFrame!=c){if(this.currentFrame){this.currentFrame.className="frameControlItem"}this.currentFrame=c;this.currentFrame.className="frameControlItem current"}}});paella.plugins.frameControlPlugin=new paella.plugins.FrameControlPlugin();paella.plugins.FullScreenPlugin=Class.create(paella.ButtonPlugin,{getIndex:function(){return 551},getAlignment:function(){return"right"},getSubclass:function(){return"showFullScreenButton"},getName:function(){return"es.upv.paella.fullScreenButtonPlugin"},checkEnabled:function(a){a(!paella.extended)},getDefaultToolTip:function(){return paella.dictionary.translate("Go FullScreen")},action:function(a){if(window==window.top){this.doFullScreen(a)}else{window.top.location=window.location}},doFullScreen:function(b){var a=document.getElementById(paella.player.mainContainer.id);a.style.width="100%";a.style.height="100%";if(this.isFullscreen()){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();b.className=this.getButtonItemClass(false)}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen();b.className=this.getButtonItemClass(false)}else{if(document.cancelFullScreen){document.cancelFullScreen();b.className=this.getButtonItemClass(false)}}}}else{if(a.webkitRequestFullScreen){a.webkitRequestFullScreen();b.className=this.getButtonItemClass(true)}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen();b.className=this.getButtonItemClass(true)}else{if(a.requestFullScreen()){a.requestFullScreen();b.className=this.getButtonItemClass(true)}else{alert("Your browser does not support fullscreen mode")}}}}},isFullscreen:function(){if(document.webkitIsFullScreen!=undefined){return document.webkitIsFullScreen}else{if(document.mozFullScreen!=undefined){return document.mozFullScreen}}return false},getButtonItemClass:function(a){return"buttonPlugin "+this.getAlignment()+" "+this.getSubclass()+((a)?" active":"")}});paella.plugins.fullScreenPlugin=new paella.plugins.FullScreenPlugin();paella.plugins.PlayPauseButtonPlugin=Class.create(paella.ButtonPlugin,{playSubclass:"playButton",pauseSubclass:"pauseButton",getAlignment:function(){return"left"},getSubclass:function(){return this.playSubclass},getName:function(){return"es.upv.paella.playPauseButtonPlugin"},getDefaultToolTip:function(){return paella.dictionary.translate("Play")},getIndex:function(){return 110},setup:function(){var a=this;paella.events.bind(paella.events.play,function(b){a.changeSubclass(a.pauseSubclass);a.setToolTip(paella.dictionary.translate("Pause"))});paella.events.bind(paella.events.pause,function(b){a.changeSubclass(a.playSubclass);a.setToolTip(paella.dictionary.translate("Play"))})},action:function(a){if(paella.player.videoContainer.paused()){paella.events.trigger(paella.events.play)}else{paella.events.trigger(paella.events.pause)}}});paella.plugins.playPauseButtonPlugn=new paella.plugins.PlayPauseButtonPlugin();paella.plugins.PlayButtonOnScreen=Class.create(paella.EventDrivenPlugin,{containerId:"paella_plugin_PlayButtonOnScreen",container:null,enabled:true,isPlaying:false,setup:function(){this.container=document.createElement("div");this.container.className="playButtonOnScreen";this.container.id=this.containerId;paella.player.videoContainer.domElement.appendChild(this.container);var b=this;$(this.container).click(function(d){b.onPlayButtonClick()});var c=document.createElement("canvas");c.className="playButtonOnScreenIcon";c.setAttribute("width",300);c.setAttribute("height",300);var a=c.getContext("2d");a.beginPath();a.arc(150,150,140,0,2*Math.PI,true);a.closePath();a.strokeStyle="white";a.lineWidth=10;a.stroke();a.fillStyle="#8f8f8f";a.fill();a.beginPath();a.moveTo(100,70);a.lineTo(250,150);a.lineTo(100,230);a.lineTo(100,70);a.closePath();a.fillStyle="white";a.fill();a.stroke();this.container.appendChild(c)},getEvents:function(){return[paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(a,b){switch(a){case paella.events.endVideo:this.endVideo();break;case paella.events.play:this.play();break;case paella.events.pause:this.pause();break;case paella.events.showEditor:this.showEditor();break;case paella.events.hideEditor:this.hideEditor();break}},onPlayButtonClick:function(){$(document).trigger(paella.events.play)},endVideo:function(){this.isPlaying=false;this.checkStatus()},play:function(){this.isPlaying=true;this.checkStatus()},pause:function(){this.isPlaying=false;this.checkStatus()},showEditor:function(){this.enabled=false;this.checkStatus()},hideEditor:function(){this.enabled=true;this.checkStatus()},checkStatus:function(){if((this.enabled&&this.isPlaying)||!this.enabled){$(this.container).hide()}else{$(this.container).show()}},checkEnabled:function(a){a(true)},getIndex:function(){return 1010},getName:function(){return"es.upv.paella.playButtonOnScreen"}});new paella.plugins.PlayButtonOnScreen();paella.plugins.MultipleQualitiesPlugin=Class.create(paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],getAlignment:function(){return"right"},getSubclass:function(){return"showMultipleQualitiesPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.multipleQualitiesPlugin"},getDefaultToolTip:function(){return paella.dictionary.translate("Change video quality")},checkEnabled:function(a){a(this.checkStreams())},setup:function(){if(paella.utils.language()=="es"){var a={Presenter:"Presentador",Slide:"Diapositiva"};paella.dictionary.addDictionary(a)}},checkStreams:function(){this.currentMaster=paella.player.videoContainer.currentMasterVideoData;this.currentSlave=paella.player.videoContainer.currentSlaveVideoData;var b=paella.player.videoContainer.masterVideoData.sources;for(key in b){for(var a=0;a<b[key].length;++a){if((b[key][a].type==this.currentMaster.type)){this.availableMasters.push(b[key][a])}}}if(this.currentSlave){var c=paella.player.videoContainer.slaveVideoData.sources;for(key in c){for(var a=0;a<c[key].length;++a){if((c[key][a].type==this.currentSlave.type)){this.availableSlaves.push(c[key][a])}}}}return(this.availableMasters.length>1||this.availableSlaves.length>1)},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(d){var i=this;this.currentUrl=window.location;var m=document.createElement("div");m.className="selectQuality";var a=document.createElement("label");a.innerHTML=paella.dictionary.translate("Presenter");var g=document.createElement("select");g.id="master";$(g).change(function(){var h=$(g).val();i.changeVideoStream(h,g.id)});if(this.availableMasters.length>1){for(var c=0;c<this.availableMasters.length;++c){var k=this.availableMasters[c].res.w;var f=this.availableMasters[c].res.h;var e=document.createElement("option");e.value=k+"x"+f;e.innerHTML=k+" x "+f;if((k==this.currentMaster.res.w)&&(f==this.currentMaster.res.h)){e.setAttribute("selected",true)}g.appendChild(e)}m.appendChild(a);m.appendChild(g)}var l=document.createElement("label");l.innerHTML=paella.dictionary.translate("Slide");var b=document.createElement("select");b.id="slave";$(b).change(function(){var h=$(b).val();i.changeVideoStream(h,b.id)});if(this.availableSlaves.length+1>1){for(var c=0;c<this.availableSlaves.length;++c){var k=this.availableSlaves[c].res.w;var f=this.availableSlaves[c].res.h;var e=document.createElement("option");e.value=k+"x"+f;e.innerHTML=k+" x "+f;if((k==this.currentSlave.res.w)&&(f==this.currentSlave.res.h)){e.setAttribute("selected",true)}b.appendChild(e)}m.appendChild(l);m.appendChild(b)}d.appendChild(m)},changeVideoStream:function(e,d){var c;var a=paella.utils.parameters.get("resmaster");var b=paella.utils.parameters.get("resslave");if(d=="master"){if(a){c=this.constructNewUrl("resmaster",e,"resslave",b)}else{c=this.currentUrl+"&resmaster="+e}}else{if(b){c=this.constructNewUrl("resslave",e,"resmaster",a)}else{c=this.currentUrl+"&resslave="+e}}window.open(c,"_self",false)},constructNewUrl:function(d,a,b,c){var e=this.currentUrl.href.split("&");return e[0]+"&"+d+"="+a+((c)?"&"+b+"="+c:"")}});paella.plugins.multipleQualitiesPlugin=new paella.plugins.MultipleQualitiesPlugin();paella.plugins.QuestionsPlayerPlugin=Class.create(paella.EventDrivenPlugin,{tests:null,lastEvent:null,visibleTest:null,numberquestion:null,lastTime:null,isStarted:null,getName:function(){return"es.uc3m.paella.QuestionsPlayerPlugin"},checkEnabled:function(c){var b=this;this.server=this.config.server;this.basepath=this.config.basepath;this.visibleTest=[];this.numberquestion=0;this.lastEvent=0;this.isStarted=false;var a=paella.utils.parameters.get("id");if(a){urlxml=""+a;urlservidor="";jQuery.ajax({context:b,type:"GET",url:urlxml,async:false,dataType:"xml",success:function(d){this.parsedata(d)},error:function(f,d,e){alert("File not found")}})}c(true)},getEvents:function(){return[paella.events.timeUpdate,paella.events.play,paella.events.seekTo,paella.events.pause,paella.events.endVideo]},onEvent:function(a,c){if(a=="paella:timeupdate"){this.isStarted=true;lastTime=c.currentTime;this.checkTests(c)}else{if(a=="paella:play"){if(this.isStarted){var b={timestamp:lastTime,user:this.config.user,origin:this.config.origin,time:new Date(),type:"playvideo",params:{user:this.config.user,origin:this.config.origin,timestamp:lastTime}};paella.data.write("events",{id:paella.initDelegate.getId()},b,function(e,d){})}}else{if(a=="paella:setseek"){this.clearAllTests(c)}else{if(a=="paella:pause"){if(this.isStarted){var b={timestamp:lastTime,user:this.config.user,origin:this.config.origin,time:new Date(),type:"pausevideo",params:{user:this.config.user,origin:this.config.origin,timestamp:lastTime}}}paella.data.write("events",{id:paella.initDelegate.getId()},b,function(e,d){})}else{if(a=="paella:endvideo"){var b={timestamp:lastTime,user:this.config.user,origin:this.config.origin,time:new Date(),type:"endvideo",params:{timestamp:lastTime}};paella.data.write("events",{id:paella.initDelegate.getId()},b,function(e,d){})}}}}}},checkTests:function(g){for(var f=0;f<this.tests.items.length;++f){var d=this.tests.items[f];var c=false;if((d.starttime/1000)<g.currentTime&&((d.starttime/1000)+0.5)>g.currentTime){if(!d.showed){paella.events.trigger(paella.events.pause);if(f!=0){c=this.tests.items[f-1];c.showed=false}this.showTest(d,c)}}}for(var e in this.visibleTest){if(typeof(d)=="object"){var d=this.visibleTest[e];if(d&&((d.starttime/1000)>=g.currentTime||((d.starttime/1000)+0.5)<=g.currentTime)){this.removeTest(d)}}}},showTest:function(j,h){var a=this;var k=j;var d=j.questionsarray[this.numberquestion];var b=-1;var f=jQuery('<div class="questions"></div>');$("#questionsContainer").append(f);strhtml='<h1 style="font-size:140%;">'+j.title+'</h1><p style="color:#000000;font-size:100%;">'+d.text+'<p><table border=0 style="width:80%;margin-left: auto; margin-right: auto;">';for(var g=0;g<d.responsesarray.length;g++){strhtml+='<tr style="vertical-align:middle;">';strhtml+='<td style="text-align:center;vertical-align:middle;"><input class = "response" type = "radio" name = "r"'+g+' id = "'+d.responsesarray[g].order+'" value = "'+d.responsesarray[g].order+'" style="margin:0px 0px 8px 0px;" /></td><td style="text-align:left;vertical-align:middle;"><label for = "r'+g+'" style="color:#000000;text-shadow:0px 0px 0;rgba(0,0,0,0);">'+d.responsesarray[g].text+"</label></td>";strhtml+="</tr>"}strhtml+='<tr><td></td><td></td></tr><tr><td></td><td><button class="button" id="validate">Contestar</button></td></tr>';strhtml+="</table>";f.html(strhtml);var c={};c.closeButton=false;c.width="75%";c.height="50%";var e=paella.messageBox.showElement(f.get(0),c);$(document).on("click",".button",function(l){if($(this).prop("id")=="validate"){if(b<0){alert("Debe seleccionar una respuesta")}else{$(document).off("click",".button");a.checkAnswer(d,b,j,h)}}if($(this).prop("id")=="back"){a.numberquestion=0;var i={timestamp:paella.player.videoContainer.currentTime(),user:a.config.user,origin:a.config.origin,time:new Date(),type:"repeatsection",params:{test:a.Test}};paella.data.write("events",{id:paella.initDelegate.getId()},i,function(o,n){});if(h){j.showed=false;h.showed=true;var m={};m.time=h.starttime/1000;paella.events.trigger(paella.events.seekToTime,m);$(document).off("click",".button");paella.messageBox.close();paella.events.trigger(paella.events.play)}else{j.showed=false;var m={};m.time=0;paella.events.trigger(paella.events.seekToTime,m);$(document).off("click",".button");paella.messageBox.close();paella.events.trigger(paella.events.play)}}});$(document).on("click",".response",function(l){b=$(this).prop("value");var i={timestamp:paella.player.videoContainer.currentTime(),user:a.config.user,origin:a.config.origin,time:new Date(),type:"answerchosen",params:{test:a.Test,question:a.numberquestion,answerChosen:a.responsevalue}};paella.data.write("events",{id:paella.initDelegate.getId()},i,function(n,m){})})},checkAnswer:function(b,a,h,c){var g=this;var d=h;var f="";f+="<h1>"+h.title+'</h1><p style="color:#000000;">'+b.text+"<p>";if(b.canswer==Math.pow(2,a)){f+='<center><font color="#00FF00">Respuesta correcta</font></center><p>';var e={timestamp:lastTime,user:this.config.user,origin:this.config.origin,idTest:h.id,time:new Date(),type:"validateanswer",params:{test:h,question:this.numberquestion,correct:true}};paella.data.write("events",{id:paella.initDelegate.getId()},e,function(j,i){})}else{f+='<center><font color="#FF0000">Respuesta incorrecta</font></center><p>';var e={timestamp:lastTime,user:this.config.user,origin:this.config.origin,idTest:h.id,time:new Date(),type:"validateanswer",params:{test:h,question:this.numberquestion,correct:false}};paella.data.write("events",{id:paella.initDelegate.getId()},e,function(j,i){})}f+='<p><button class="button" id="back">Volver a visualizar</button><button class="button" id="Continue">Continuar</button>';$("div.questions").html(f);$(document).on("click",".button",function(j){if($(this).prop("id")=="Continue"){if(h.questionsarray.length-1==g.numberquestion){$(document).off("click",".button");g.removeTest(h)}else{$(document).off("click",".button");g.nextQuestion(h,c)}}if($(this).prop("id")=="back"){g.numberquestion=0;var i={timestamp:paella.player.videoContainer.currentTime(),user:g.config.user,origin:g.config.origin,time:new Date(),type:"repeatsection",params:{test:g.Test}};paella.data.write("events",{id:paella.initDelegate.getId()},i,function(m,l){});if(c){h.showed=false;c.showed=true;var k={};k.time=c.starttime/1000;paella.events.trigger(paella.events.seekToTime,k);$(document).off("click",".button");paella.messageBox.close();paella.events.trigger(paella.events.play)}else{h.showed=false;var k={};k.time=0;paella.events.trigger(paella.events.seekToTime,k);$(document).off("click",".button");paella.messageBox.close();paella.events.trigger(paella.events.play)}}})},nextQuestion:function(b,a){this.numberquestion++;$(document).off("click",".response");paella.messageBox.close();this.showTest(b,a)},removeTest:function(a){this.numberquestion=0;a.showed=true;$(document).off("click",".response");paella.messageBox.close();paella.events.trigger(paella.events.play)},clearAllTests:function(g){$(document).off("click",".response");var e=this.lastTime;var c=(g.newPositionPercent*paella.player.videoContainer.duration()/100);var f={timestamp:lastTime,user:this.config.user,origin:this.config.origin,time:new Date(),type:"seekbar",params:{start:e,finish:c}};paella.data.write("events",{id:paella.initDelegate.getId()},f,function(h,a){});for(var d=0;d<this.tests.items.length;++d){var b=this.tests.items[d];b.showed=false}},parsedata:function(e){var f=this;this.tests={items:[]};var b=jQuery.xml2json(e);var c=b.RDF.Description.Tracks.Bag.li.Description.markers.Seq.li;if(c instanceof Array){$.each(c,function(j,h){f.tests.items.push({id:f.getTrackUniqueId(),starttime:getProperty(h.Description,"xmpDM:startTime"),title:getProperty(h.Description,"tscIQ:questionSetName"),questionsarray:[]});var i=h.Description.questions.Seq.li;if(i instanceof Array){$.each(i,function(m,l){f.tests.items[j].questionsarray.push({text:l.Description.question,canswer:l.Description.correctAnswer,responsesarray:[]});var k=l.Description.answerArray.Seq.li;$.each(k,function(o,n){f.tests.items[j].questionsarray[m].responsesarray.push({text:n.Description.answer,order:getProperty(n.Description,"tscIQ:orderId")})})})}else{f.tests.items[j].questionsarray.push({text:i.Description.question,canswer:i.Description.correctAnswer,responsesarray:[]});var g=i.Description.answerArray.Seq.li;$.each(g,function(l,k){f.tests.items[j].questionsarray[0].responsesarray.push({text:k.Description.answer,order:getProperty(k.Description,"tscIQ:orderId")})})}})}else{this.tests.items.push({id:f.getTrackUniqueId(),starttime:getProperty(c.Description,"xmpDM:startTime"),title:getProperty(c.Description,"tscIQ:questionSetName"),questionsarray:[]});var d=c.Description.questions.Seq.li;if(d instanceof Array){$.each(d,function(i,h){f.tests.items[0].questionsarray.push({text:h.Description.question,canswer:h.Description.correctAnswer,responsesarray:[]});var g=h.Description.answerArray.Seq.li;$.each(g,function(k,j){f.tests.items[0].questionsarray[i].responsesarray.push({text:j.Description.answer,order:getProperty(j.Description,"tscIQ:orderId")})})})}else{f.tests.items[0].questionsarray.push({text:d.Description.question,canswer:d.Description.correctAnswer,responsesarray:[]});var a=d.Description.answerArray.Seq.li;$.each(a,function(h,g){f.tests.items[0].questionsarray[0].responsesarray.push({text:g.Description.answer,order:getProperty(g.Description,"tscIQ:orderId")})})}}paella.data.write("questions","tests",f.tests,function(h,g){})},getTrackUniqueId:function(){var a=-1;if(this.tests.items.length==0){return 1}for(var b=0;b<this.tests.items.length;b++){if(a<=this.tests.items[b].id){a=this.tests.items[b].id+1}}return a}});paella.plugins.QuestionsPlayerPlugin=new paella.plugins.QuestionsPlayerPlugin();paella.plugins.RepeatButtonPlugin=Class.create(paella.ButtonPlugin,{repeatSubclass:"repeatButton",getAlignment:function(){return"left"},getSubclass:function(){return this.repeatSubclass},getName:function(){return"es.upv.paella.repeatButtonPlugin"},getIndex:function(){return 120},getDefaultToolTip:function(){return paella.dictionary.translate("Rewind 30 seconds")},action:function(a){var b=paella.player.videoContainer.currentTime()-30;paella.events.trigger(paella.events.seekToTime,{time:b})}});paella.plugins.repeatButtonPlugin=new paella.plugins.RepeatButtonPlugin();paella.ShowEditorPlugin=Class.create(paella.VideoOverlayButtonPlugin,{isEditorVisible:function(){return paella.editor.instance!=null},getIndex:function(){return 10},getSubclass:function(){return"showEditorButton"},getAlignment:function(){return"right"},getDefaultToolTip:function(){return paella.dictionary.translate("Enter editor mode")},checkEnabled:function(a){a(paella.editor&&paella.player.config.editor&&paella.player.config.editor.enabled&&!paella.utils.userAgent.browser.IsMobileVersion&&(paella.initDelegate.initParams.accessControl.permissions.canWrite||this.config.alwaysVisible))},setup:function(){var a=this;paella.events.bind(paella.events.hideEditor,function(b){a.onHideEditor()});paella.events.bind(paella.events.showEditor,function(b){a.onShowEditor()})},action:function(b){var a=this.config.editorPage?this.config.editorPage:"";if((paella.extended)||(window!=window.top)){window.open(a+"?id="+paella.player.videoIdentifier,"_top")}else{paella.events.trigger(paella.events.showEditor)}},onHideEditor:function(){this.showButton()},onShowEditor:function(){this.hideButton()},getName:function(){return"es.upv.paella.ShowEditorPlugin"}});paella.plugins.showEditorPlugin=new paella.ShowEditorPlugin();paella.plugins.SnapShotsEditorPlugin=Class.create(paella.editor.TrackPlugin,{tracks:null,selectedTrackItem:null,highResFrames:null,getIndex:function(){return 0},checkEnabled:function(b){var a=paella.initDelegate.initParams.videoLoader.frameList;b(a!=null)},setup:function(){if(paella.utils.language()=="es"){var a={Slides:"Diapositivas",Slide:"Diapositiva"};paella.dictionary.addDictionary(a)}},showHiResFrame:function(b){var e=document.createElement("div");var c=document.createElement("div");var a=document.createElement("img");a.className="frameHiRes";a.setAttribute("src",b);a.setAttribute("style","width: 100%;");$(c).append(a);$(e).append(c);e.setAttribute("style","display: table;");c.setAttribute("style","display: table-cell; vertical-align:middle;");overlayContainer=paella.player.videoContainer.overlayContainer;var d=paella.initDelegate.initParams.videoLoader.streams;if(d.length==1){overlayContainer.addElement(e,overlayContainer.getMasterRect())}else{if(d.length>=2){overlayContainer.addElement(e,overlayContainer.getSlaveRect())}}overlayContainer.enableBackgroundMode();this.hiResFrame=e},removeHiResFrame:function(){overlayContainer=paella.player.videoContainer.overlayContainer;overlayContainer.removeElement(this.hiResFrame);overlayContainer.disableBackgroundMode()},createTrackContent:function(b,a){onMouseOverScript="paella.plugins.snapShotsEditorPlugin.showHiResFrame('"+b.url+"');";onMouseOutScript="paella.plugins.snapShotsEditorPlugin.removeHiResFrame();";return'<div class="snapShotsEditorPluginBox" onmouseover="'+onMouseOverScript+'" onmouseout="'+onMouseOutScript+'">	<img class="snapShotsEditorPluginImage" src="'+b.thumb+'"/>	<div class="snapShotsEditorPluginSliteText">'+paella.dictionary.translate("Slide")+" "+a+"</div></div>"},getTrackItems:function(){if(this.tracks==null){this.tracks=[];var i=paella.initDelegate.initParams.videoLoader.frameList;if(i){var a=0;var f=Object.keys(paella.initDelegate.initParams.videoLoader.frameList);for(;a<f.length-1;a++){var b=i[f[a]];var c=parseInt(f[a]);var g=parseInt(f[a+1]);var h=g-c;this.tracks.push({s:c,e:g,d:h,name:this.createTrackContent(b,a+1)})}if(f.length>0){var b=i[f[a]];var c=parseInt(f[a]);var g=paella.player.videoContainer.duration();var h=g-c;this.tracks.push({s:c,e:g,d:h,name:this.createTrackContent(b,a+1)})}}}return this.tracks},getTools:function(){return[]},onToolSelected:function(a){},getTrackUniqueId:function(){var a=-1;if(this.tracks.length==0){return 1}for(var b=0;b<this.tracks.length;++b){if(a<=this.tracks[b].id){a=this.tracks[b].id+1}}return a},getName:function(){return"es.upv.paella.editor.SnapShotsEditorPlugin"},getTrackName:function(){return paella.dictionary.translate("Slides")},getColor:function(){return"rgb(159, 166, 88)"},getTextColor:function(){return"rgb(90,90,90)"},allowEditContent:function(){return false},allowDrag:function(){return false},allowResize:function(){return false},getTrackItem:function(b){for(var a=0;a<this.tracks.length;++a){if(this.tracks[a].id==b){return this.tracks[a]}}},onSave:function(a){a(true)}});paella.plugins.snapShotsEditorPlugin=new paella.plugins.SnapShotsEditorPlugin();paella.plugins.SocialPlugin=Class.create(paella.ButtonPlugin,{buttonItems:null,socialMedia:null,getAlignment:function(){return"right"},getSubclass:function(){return"showSocialPluginButton"},getIndex:function(){return 560},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.socialPlugin"},checkEnabled:function(a){a(true)},getDefaultToolTip:function(){return paella.dictionary.translate("Share this video")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buttons:[],selected_button:null,setup:function(){var a=this;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40};$(this.button).keyup(function(b){if(a.isPopUpOpen()){if(b.keyCode==Keys.Up){if(a.selected_button>0){if(a.selected_button<a.buttons.length){a.buttons[a.selected_button].className="socialItemButton "+a.buttons[a.selected_button].data.mediaData}a.selected_button--;a.buttons[a.selected_button].className=a.buttons[a.selected_button].className+" selected"}}else{if(b.keyCode==Keys.Down){if(a.selected_button<a.buttons.length-1){if(a.selected_button>=0){a.buttons[a.selected_button].className="socialItemButton "+a.buttons[a.selected_button].data.mediaData}a.selected_button++;a.buttons[a.selected_button].className=a.buttons[a.selected_button].className+" selected"}}else{if(b.keyCode==Keys.Return){a.onItemClick(a.buttons[a.selected_button].data.mediaData)}}}}})},buildContent:function(e){var a=this;this.buttonItems={};socialMedia=["facebook","twitter"];for(var d in socialMedia){var c=socialMedia[d];var b=a.getSocialMediaItemButton(c);a.buttonItems[d]=b;e.appendChild(b);this.buttons.push(b)}this.selected_button=a.buttons.length},getSocialMediaItemButton:function(a){var b=document.createElement("div");b.className="socialItemButton "+a;b.id=a+"_button";b.data={mediaData:a,plugin:this};$(b).click(function(c){this.data.plugin.onItemClick(this.data.mediaData)});return b},onItemClick:function(b){var a=this.getVideoUrl();switch(b){case ("twitter"):window.open("http://twitter.com/home?status="+a);break;case ("facebook"):window.open("http://www.facebook.com/sharer.php?u="+a);break}paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()})},getVideoUrl:function(){var a=document.location.href;return a}});paella.plugins.socialPlugin=new paella.plugins.SocialPlugin();paella.plugins.TrimmingLoaderPlugin=Class.create(paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.TrimmingPlayerPlugin"},getEvents:function(){return[paella.events.loadComplete,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(a,b){switch(a){case paella.events.loadComplete:this.loadTrimming();break;case paella.events.showEditor:paella.player.videoContainer.disableTrimming();break;case paella.events.hideEditor:if(paella.player.config.trimming&&paella.player.config.trimming.enabled){paella.player.videoContainer.enableTrimming()}break}},loadTrimming:function(){var a=paella.initDelegate.getId();paella.data.read("trimming",{id:a},function(c,b){if(c&&b&&c.end>0){paella.player.videoContainer.enableTrimming();paella.player.videoContainer.setTrimming(c.start,c.end)}})}});paella.plugins.trimmingLoaderPlugin=new paella.plugins.TrimmingLoaderPlugin();paella.plugins.TrimmingTrackPlugin=Class.create(paella.editor.MainTrackPlugin,{trimmingTrack:null,trimmingData:{s:0,e:0},getTrackItems:function(){if(this.trimmingTrack==null){this.trimmingTrack={id:1,s:0,e:0};this.trimmingTrack.s=paella.player.videoContainer.trimStart();this.trimmingTrack.e=paella.player.videoContainer.trimEnd();this.trimmingData.s=this.trimmingTrack.s;this.trimmingData.e=this.trimmingTrack.e}var a=[];a.push(this.trimmingTrack);return a},getName:function(){return"es.upv.paella.editor.TrimmingTrackPlugin"},getTrackName:function(){return paella.dictionary.translate("Trimming")},getColor:function(){return"rgb(0, 51, 107)"},onSave:function(a){paella.player.videoContainer.enableTrimming();paella.player.videoContainer.setTrimmingStart(this.trimmingTrack.s);paella.player.videoContainer.setTrimmingEnd(this.trimmingTrack.e);paella.data.write("trimming",{id:paella.initDelegate.getId()},{start:this.trimmingTrack.s,end:this.trimmingTrack.e},function(c,b){a(b)})},onDiscard:function(a){this.trimmingTrack.s=this.trimmingData.s;this.trimmingTrack.e=this.trimmingData.e;a(true)},allowDrag:function(){return false},onTrackChanged:function(c,b,a){this.trimmingTrack.s=b;this.trimmingTrack.e=a;this.parent(c,b,a)},contextHelpString:function(){if(paella.utils.language()=="es"){return'Utiliza la herramienta de recorte para definir el instante inicial y el instante final de la clase. Para cambiar la duración solo hay que arrastrar el inicio o el final de la pista "Recorte", en la linea de tiempo.'}else{return"Use this tool to define the start and finish time."}}});paella.plugins.trimmingTrackPlugin=new paella.plugins.TrimmingTrackPlugin();paella.plugins.ViewModePlugin=Class.create(paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,getAlignment:function(){return"right"},getSubclass:function(){return"showViewModeButton"},getIndex:function(){return 540},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.viewModePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return paella.dictionary.translate("Change video layout")},checkEnabled:function(a){a(paella.initDelegate.initParams.videoLoader.streams.length>=2)},setup:function(){var a=this;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40};$(this.button).keyup(function(b){if(a.isPopUpOpen()){if(b.keyCode==Keys.Up){if(a.selected_button>0){if(a.selected_button<a.buttons.length){a.buttons[a.selected_button].className="viewModeItemButton "+a.buttons[a.selected_button].data.profile}a.selected_button--;a.buttons[a.selected_button].className=a.buttons[a.selected_button].className+" selected"}}else{if(b.keyCode==Keys.Down){if(a.selected_button<a.buttons.length-1){if(a.selected_button>=0){a.buttons[a.selected_button].className="viewModeItemButton "+a.buttons[a.selected_button].data.profile}a.selected_button++;a.buttons[a.selected_button].className=a.buttons[a.selected_button].className+" selected"}}else{if(b.keyCode==Keys.Return){a.onItemClick(a.buttons[a.selected_button],a.buttons[a.selected_button].data.profile,a.buttons[a.selected_button].data.profile)}}}}})},buildContent:function(b){var a=this;this.buttonItems={};paella.Profiles.loadProfileList(function(c){for(var e in c){var f=c[e];var d=a.getProfileItemButton(e,f);a.buttonItems[e]=d;b.appendChild(d);a.buttons.push(d)}a.selected_button=a.buttons.length})},getProfileItemButton:function(a,c){var b=document.createElement("div");b.className=this.getButtonItemClass(a,false);b.id=a+"_button";b.data={profile:a,profileData:c,plugin:this};$(b).click(function(d){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)});return b},onItemClick:function(b,c,d){var a=this.buttonItems[paella.player.selectedProfile];var e=this.buttonItems[c];if(e&&a!=e){a.className=this.getButtonItemClass(paella.player.selectedProfile,false);e.className=this.getButtonItemClass(c,true);paella.events.trigger(paella.events.setProfile,{profileName:c});paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()})}},getButtonItemClass:function(b,a){return"viewModeItemButton "+b+((a)?" selected":"")}});paella.plugins.viewModePlugin=new paella.plugins.ViewModePlugin();